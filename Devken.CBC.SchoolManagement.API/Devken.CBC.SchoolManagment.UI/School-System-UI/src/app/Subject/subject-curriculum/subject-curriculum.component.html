<!-- subject-curriculum/subject-curriculum.component.html -->
<div class="max-w-6xl">

  <!-- Section Header -->
  <div class="flex items-start gap-4 mb-8">
    <div class="flex items-center justify-center w-14 h-14 rounded-xl bg-gradient-to-br from-violet-500 to-indigo-600 shadow-lg">
      <mat-icon class="text-white !w-7 !h-7">school</mat-icon>
    </div>
    <div class="flex-1">
      <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-1">Curriculum Details</h2>
      <p class="text-gray-600 dark:text-gray-400">
        {{ isEditMode
          ? 'Update the subject type and CBC curriculum level.'
          : 'Select how this subject fits into the CBC curriculum. Both fields are required.' }}
      </p>
    </div>
  </div>

  <!-- Info Alert -->
  <fuse-alert *ngIf="!isEditMode" type="info" appearance="soft" [showIcon]="true" class="mb-6">
    <strong>Curriculum Placement:</strong> Choose the correct <strong>Subject Type</strong> to control whether students
    must take this subject or may elect it. Select the <strong>CBC Level</strong> that this subject is taught at.
  </fuse-alert>

  <form [formGroup]="form" novalidate class="space-y-6">

    <!-- Subject Type -->
    <mat-card class="shadow-md">
      <mat-card-header class="!pb-2">
        <mat-card-title class="!text-base !font-semibold flex items-center gap-2">
          <mat-icon class="text-violet-600">category</mat-icon>
          Subject Type
          <span class="ml-auto text-xs font-medium px-2 py-1 bg-red-100 text-red-700
                       dark:bg-red-900/30 dark:text-red-300 rounded">Required</span>
        </mat-card-title>
      </mat-card-header>
      <mat-card-content class="!pt-4">

        <!-- Visual type cards -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
          <div
            *ngFor="let t of subjectTypes"
            class="relative rounded-xl border-2 cursor-pointer p-4 transition-all"
            [ngClass]="{
              'border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20 shadow-md': form.get('subjectType')?.value == t.value,
              'border-gray-200 dark:border-gray-700 hover:border-indigo-300 hover:bg-gray-50 dark:hover:bg-gray-800': form.get('subjectType')?.value != t.value
            }"
            (click)="form.get('subjectType')?.setValue(t.value)">
            <div class="flex items-center gap-2 mb-2">
              <mat-icon
                class="icon-size-5"
                [ngClass]="{
                  'text-indigo-600': form.get('subjectType')?.value == t.value,
                  'text-gray-400': form.get('subjectType')?.value != t.value
                }">
                {{ t.value === 1 ? 'star' : t.value === 2 ? 'tune' : t.value === 3 ? 'auto_awesome' : 'sports' }}
              </mat-icon>
              <span
                class="text-sm font-semibold"
                [ngClass]="{
                  'text-indigo-700 dark:text-indigo-300': form.get('subjectType')?.value == t.value,
                  'text-gray-700 dark:text-gray-300':     form.get('subjectType')?.value != t.value
                }">
                {{ t.label }}
              </span>
            </div>
            <p class="text-xs text-gray-500 dark:text-gray-400 leading-relaxed">
              {{ t.value === 1 ? 'Mandatory for all students' :
                 t.value === 2 ? 'Student choice subject' :
                 t.value === 3 ? 'Specialisation subject' :
                                 'Extracurricular activity' }}
            </p>
            <!-- Selected checkmark -->
            <div
              *ngIf="form.get('subjectType')?.value == t.value"
              class="absolute top-2 right-2 w-5 h-5 rounded-full bg-indigo-600 flex items-center justify-center">
              <mat-icon class="!w-3 !h-3 !text-xs text-white">check</mat-icon>
            </div>
          </div>
        </div>

        <!-- Hidden select for form validation -->
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Subject Type *</mat-label>
          <mat-select formControlName="subjectType">
            <mat-option [value]="null">Select type</mat-option>
            <mat-option *ngFor="let t of subjectTypes" [value]="t.value">{{ t.label }}</mat-option>
          </mat-select>
          <mat-icon matPrefix class="text-gray-400">category</mat-icon>
          <mat-hint *ngIf="selectedTypeDescription">{{ selectedTypeDescription }}</mat-hint>
          <mat-error>{{ getError('subjectType') }}</mat-error>
        </mat-form-field>

      </mat-card-content>
    </mat-card>

    <!-- CBC Level -->
    <mat-card class="shadow-md">
      <mat-card-header class="!pb-2">
        <mat-card-title class="!text-base !font-semibold flex items-center gap-2">
          <mat-icon class="text-violet-600">stairs</mat-icon>
          CBC Level
          <span class="ml-auto text-xs font-medium px-2 py-1 bg-red-100 text-red-700
                       dark:bg-red-900/30 dark:text-red-300 rounded">Required</span>
        </mat-card-title>
      </mat-card-header>
      <mat-card-content class="!pt-4">

        <!-- Level grouped visually: PP & Lower Primary & Upper Primary & Secondary -->
        <div class="mb-4 space-y-3">

          <!-- Pre-Primary -->
          <div>
            <p class="text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-400 mb-2">
              Pre-Primary
            </p>
            <div class="flex flex-wrap gap-2">
              <div
                *ngFor="let lvl of cbcLevels.slice(0, 2)"
                class="rounded-lg border-2 cursor-pointer px-4 py-2 text-sm font-medium transition-all"
                [ngClass]="{
                  'border-violet-500 bg-violet-50 dark:bg-violet-900/20 text-violet-700 dark:text-violet-300':  form.get('cbcLevel')?.value == lvl.value,
                  'border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 hover:border-violet-300': form.get('cbcLevel')?.value != lvl.value
                }"
                (click)="form.get('cbcLevel')?.setValue(lvl.value)">
                {{ lvl.label }}
              </div>
            </div>
          </div>

          <!-- Lower Primary -->
          <div>
            <p class="text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-400 mb-2">
              Lower Primary
            </p>
            <div class="flex flex-wrap gap-2">
              <div
                *ngFor="let lvl of cbcLevels.slice(2, 5)"
                class="rounded-lg border-2 cursor-pointer px-4 py-2 text-sm font-medium transition-all"
                [ngClass]="{
                  'border-violet-500 bg-violet-50 dark:bg-violet-900/20 text-violet-700 dark:text-violet-300':  form.get('cbcLevel')?.value == lvl.value,
                  'border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 hover:border-violet-300': form.get('cbcLevel')?.value != lvl.value
                }"
                (click)="form.get('cbcLevel')?.setValue(lvl.value)">
                {{ lvl.label }}
              </div>
            </div>
          </div>

          <!-- Upper Primary -->
          <div>
            <p class="text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-400 mb-2">
              Upper Primary
            </p>
            <div class="flex flex-wrap gap-2">
              <div
                *ngFor="let lvl of cbcLevels.slice(5, 9)"
                class="rounded-lg border-2 cursor-pointer px-4 py-2 text-sm font-medium transition-all"
                [ngClass]="{
                  'border-violet-500 bg-violet-50 dark:bg-violet-900/20 text-violet-700 dark:text-violet-300':  form.get('cbcLevel')?.value == lvl.value,
                  'border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 hover:border-violet-300': form.get('cbcLevel')?.value != lvl.value
                }"
                (click)="form.get('cbcLevel')?.setValue(lvl.value)">
                {{ lvl.label }}
              </div>
            </div>
          </div>

          <!-- Secondary -->
          <div>
            <p class="text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-400 mb-2">
              Secondary
            </p>
            <div class="flex flex-wrap gap-2">
              <div
                *ngFor="let lvl of cbcLevels.slice(9)"
                class="rounded-lg border-2 cursor-pointer px-4 py-2 text-sm font-medium transition-all"
                [ngClass]="{
                  'border-violet-500 bg-violet-50 dark:bg-violet-900/20 text-violet-700 dark:text-violet-300':  form.get('cbcLevel')?.value == lvl.value,
                  'border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 hover:border-violet-300': form.get('cbcLevel')?.value != lvl.value
                }"
                (click)="form.get('cbcLevel')?.setValue(lvl.value)">
                {{ lvl.label }}
              </div>
            </div>
          </div>
        </div>

        <!-- Dropdown as fallback / confirmation -->
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>CBC Level *</mat-label>
          <mat-select formControlName="cbcLevel">
            <mat-option [value]="null">Select level</mat-option>
            <mat-option *ngFor="let lvl of cbcLevels" [value]="lvl.value">{{ lvl.label }}</mat-option>
          </mat-select>
          <mat-icon matPrefix class="text-gray-400">stairs</mat-icon>
          <mat-hint>Competency-based curriculum level</mat-hint>
          <mat-error>{{ getError('cbcLevel') }}</mat-error>
        </mat-form-field>

      </mat-card-content>
    </mat-card>

  </form>
</div>