<!-- subject-review-step/subject-review-step.component.html -->
<div class="max-w-6xl">

  <!-- Section Header -->
  <div class="flex items-start gap-4 mb-8">
    <div class="flex items-center justify-center w-14 h-14 rounded-xl bg-gradient-to-br from-green-500 to-emerald-600 shadow-lg">
      <mat-icon class="text-white !w-7 !h-7">check_circle</mat-icon>
    </div>
    <div class="flex-1">
      <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-1">Review & Submit</h2>
      <p class="text-gray-600 dark:text-gray-400">Review all information before submitting. Click any section to edit.</p>
    </div>
  </div>

  <!-- Completion Progress Bar -->
  <div class="mb-6">
    <div class="h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mb-2">
      <div
        class="h-full bg-gradient-to-r from-green-500 to-emerald-600 transition-all duration-500"
        [style.width.%]="getCompletionPct()">
      </div>
    </div>
    <p class="text-sm text-gray-600 dark:text-gray-400">
      {{ completedCount() }} of {{ steps.length - 1 }} sections completed
    </p>
  </div>

  <!-- Incomplete Warning -->
  <fuse-alert
    *ngIf="!allComplete()"
    type="warning"
    appearance="soft"
    [showIcon]="true"
    class="mb-6">
    Some sections are incomplete. Please go back and fill in all required fields before submitting.
  </fuse-alert>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

    <!-- ── Identity Card ─────────────────────────────────────────── -->
    <mat-card
      class="shadow-md hover:shadow-lg transition-shadow cursor-pointer"
      (click)="editSection.emit(0)">
      <mat-card-header class="!pb-2">
        <div class="flex items-center justify-between w-full">
          <div class="flex items-center gap-3">
            <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-indigo-100 dark:bg-indigo-900/20">
              <mat-icon class="text-indigo-600">badge</mat-icon>
            </div>
            <mat-card-title class="!text-base !font-semibold !mb-0">Subject Identity</mat-card-title>
          </div>
          <div class="flex items-center gap-2">
            <span
              class="text-xs font-medium px-2 py-1 rounded"
              [ngClass]="{
                'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300': isComplete(0),
                'bg-gray-100  text-gray-600  dark:bg-gray-700      dark:text-gray-400': !isComplete(0)
              }">
              {{ isComplete(0) ? '✓ Complete' : 'Incomplete' }}
            </span>
            <mat-icon class="text-gray-400 icon-size-4">edit</mat-icon>
          </div>
        </div>
      </mat-card-header>
      <mat-card-content class="!pt-4">
        <div class="space-y-2">
          <div class="flex justify-between text-sm">
            <span class="text-gray-500 dark:text-gray-400">Name</span>
            <span class="font-semibold text-gray-900 dark:text-white">{{ identity.name || '—' }}</span>
          </div>
          <div class="flex justify-between text-sm">
            <span class="text-gray-500 dark:text-gray-400">Code</span>
            <span class="font-semibold text-gray-900 dark:text-white">
              {{ identity.code || '(auto-generated)' }}
            </span>
          </div>
          <div *ngIf="isSuperAdmin" class="flex justify-between text-sm">
            <span class="text-gray-500 dark:text-gray-400">School</span>
            <span class="font-semibold text-gray-900 dark:text-white">{{ identity.schoolId ? 'Selected' : '—' }}</span>
          </div>
          <div *ngIf="identity.description" class="flex justify-between text-sm">
            <span class="text-gray-500 dark:text-gray-400">Description</span>
            <span class="font-semibold text-gray-900 dark:text-white max-w-48 truncate text-right">
              {{ identity.description }}
            </span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- ── Curriculum Card ────────────────────────────────────────── -->
    <mat-card
      class="shadow-md hover:shadow-lg transition-shadow cursor-pointer"
      (click)="editSection.emit(1)">
      <mat-card-header class="!pb-2">
        <div class="flex items-center justify-between w-full">
          <div class="flex items-center gap-3">
            <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-violet-100 dark:bg-violet-900/20">
              <mat-icon class="text-violet-600">school</mat-icon>
            </div>
            <mat-card-title class="!text-base !font-semibold !mb-0">Curriculum Details</mat-card-title>
          </div>
          <div class="flex items-center gap-2">
            <span
              class="text-xs font-medium px-2 py-1 rounded"
              [ngClass]="{
                'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300': isComplete(1),
                'bg-gray-100  text-gray-600  dark:bg-gray-700      dark:text-gray-400': !isComplete(1)
              }">
              {{ isComplete(1) ? '✓ Complete' : 'Incomplete' }}
            </span>
            <mat-icon class="text-gray-400 icon-size-4">edit</mat-icon>
          </div>
        </div>
      </mat-card-header>
      <mat-card-content class="!pt-4">
        <div class="space-y-3">
          <div class="flex justify-between text-sm">
            <span class="text-gray-500 dark:text-gray-400">Subject Type</span>
            <span
              class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold"
              [ngClass]="{
                'bg-blue-100   text-blue-700   dark:bg-blue-900/30   dark:text-blue-300':   curriculum.subjectType == 1,
                'bg-violet-100 text-violet-700 dark:bg-violet-900/30 dark:text-violet-300': curriculum.subjectType == 2,
                'bg-amber-100  text-amber-700  dark:bg-amber-900/30  dark:text-amber-300':  curriculum.subjectType == 3,
                'bg-teal-100   text-teal-700   dark:bg-teal-900/30   dark:text-teal-300':   curriculum.subjectType == 4,
                'bg-gray-100   text-gray-600':                                              !curriculum.subjectType
              }">
              {{ curriculum.subjectType ? getSubjectTypeName(curriculum.subjectType) : '—' }}
            </span>
          </div>
          <div class="flex justify-between text-sm">
            <span class="text-gray-500 dark:text-gray-400">CBC Level</span>
            <span class="inline-flex items-center gap-1 font-semibold text-gray-900 dark:text-white">
              <mat-icon class="icon-size-4 text-violet-500">stairs</mat-icon>
              {{ curriculum.cbcLevel ? getCBCLevelName(curriculum.cbcLevel) : '—' }}
            </span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- ── Settings Card (full width) ───────────────────────────── -->
    <mat-card
      class="shadow-md hover:shadow-lg transition-shadow cursor-pointer lg:col-span-2"
      (click)="editSection.emit(2)">
      <mat-card-header class="!pb-2">
        <div class="flex items-center justify-between w-full">
          <div class="flex items-center gap-3">
            <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-teal-100 dark:bg-teal-900/20">
              <mat-icon class="text-teal-600">settings</mat-icon>
            </div>
            <mat-card-title class="!text-base !font-semibold !mb-0">Settings</mat-card-title>
          </div>
          <div class="flex items-center gap-2">
            <span class="text-xs font-medium px-2 py-1 rounded bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300">
              ✓ Saved
            </span>
            <mat-icon class="text-gray-400 icon-size-4">edit</mat-icon>
          </div>
        </div>
      </mat-card-header>
      <mat-card-content class="!pt-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

          <div class="flex items-center gap-4 p-4 rounded-xl"
               [ngClass]="{
                 'bg-amber-50 dark:bg-amber-900/10 border border-amber-200 dark:border-amber-800': settings.isCompulsory,
                 'bg-gray-50  dark:bg-gray-800/50  border border-gray-200  dark:border-gray-700':  !settings.isCompulsory
               }">
            <div class="flex items-center justify-center w-10 h-10 rounded-lg"
                 [ngClass]="settings.isCompulsory ? 'bg-amber-100 dark:bg-amber-900/30' : 'bg-gray-100 dark:bg-gray-700'">
              <mat-icon [ngClass]="settings.isCompulsory ? 'text-amber-600' : 'text-gray-400'">star</mat-icon>
            </div>
            <div>
              <p class="text-xs text-gray-500 dark:text-gray-400">Compulsory</p>
              <p class="font-bold" [ngClass]="settings.isCompulsory ? 'text-amber-700 dark:text-amber-300' : 'text-gray-600 dark:text-gray-400'">
                {{ settings.isCompulsory ? 'Yes — All students must take this' : 'No — Optional subject' }}
              </p>
            </div>
          </div>

          <div class="flex items-center gap-4 p-4 rounded-xl"
               [ngClass]="{
                 'bg-green-50 dark:bg-green-900/10 border border-green-200 dark:border-green-800': settings.isActive,
                 'bg-red-50   dark:bg-red-900/10   border border-red-200   dark:border-red-800':   !settings.isActive
               }">
            <div class="flex items-center justify-center w-10 h-10 rounded-lg"
                 [ngClass]="settings.isActive ? 'bg-green-100 dark:bg-green-900/30' : 'bg-red-100 dark:bg-red-900/30'">
              <mat-icon [ngClass]="settings.isActive ? 'text-green-600' : 'text-red-500'">
                {{ settings.isActive ? 'check_circle' : 'cancel' }}
              </mat-icon>
            </div>
            <div>
              <p class="text-xs text-gray-500 dark:text-gray-400">Status</p>
              <p class="font-bold" [ngClass]="settings.isActive ? 'text-green-700 dark:text-green-300' : 'text-red-600 dark:text-red-400'">
                {{ settings.isActive ? 'Active — Visible in the system' : 'Inactive — Hidden from assignments' }}
              </p>
            </div>
          </div>

        </div>
      </mat-card-content>
    </mat-card>

  </div>
</div>