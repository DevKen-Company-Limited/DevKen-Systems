<div class="flex flex-col h-full w-full">

  <!-- ── Page Header ──────────────────────────────────────────────────────── -->
  <app-page-header
    title="Academic Years Management"
    description="Manage your school's academic year calendar"
    icon="calendar_today"
    [breadcrumbs]="breadcrumbs"
    [actionTemplate]="headerActions">
  </app-page-header>

  <ng-template #headerActions>
  <button mat-flat-button
    class="bg-white text-indigo-700 hover:bg-yellow-200 hover:text-indigo-900 shadow-lg transition-all hover:shadow-xl font-bold"
    (click)="openCreate()">
    <mat-icon class="icon-size-5">add</mat-icon>
    <span class="ml-2">Add</span>
  </button>
</ng-template>

  <!-- ── Main Content ──────────────────────────────────────────────────────── -->
 <div class="flex flex-col flex-auto p-4 sm:p-6 gap-4 overflow-y-auto bg-gray-50 dark:bg-gray-900">
    <button mat-flat-button
      class="bg-white text-cyan-700 hover:bg-yellow-200 hover:text-cyan-900 shadow-lg transition-all hover:shadow-xl font-bold"
      (click)="openCreate()">
      <mat-icon class="icon-size-5">add</mat-icon>
      <span class="ml-2">Add</span>
    </button>
  </ng-template>

  <!-- ── Main Content ──────────────────────────────────────────────────────── -->
  <div class="bg-card -mt-10 flex-auto rounded-t-2xl p-6 shadow sm:p-10">

    <app-stats-cards [cards]="statsCards" [columns]="3"></app-stats-cards>

    <div class="mb-6">
      <app-filter-panel
        [fields]="filterFields"
        [showPanel]="showFilterPanel"
        [columns]="3"
        (filterChange)="onFilterChange($event)"
        (clearAll)="onClearFilters()"
        (togglePanel)="toggleFilterPanel()">
      </app-filter-panel>
    </div>

    <app-data-table
      [columns]="tableColumns"
      [data]="paginatedData"
      [actions]="tableActions"
      [loading]="isLoading"
      [header]="tableHeader"
      [emptyState]="tableEmptyState"
      [cellTemplates]="cellTemplates">
    </app-data-table>

    <app-pagination
      *ngIf="!isLoading"
      [currentPage]="currentPage"
      [totalItems]="filteredData.length"
      [itemsPerPage]="itemsPerPage"
      [itemLabel]="'academic years'"
      [showItemsPerPageSelector]="true"
      [showPageNumbers]="true"
      (pageChange)="onPageChange($event)"
      (itemsPerPageChange)="onItemsPerPageChange($event)">
    </app-pagination>
  </div>
</div>

<!-- ══════════════════════════════════════════════════════════════════════ -->
<!-- Cell Templates                                                        -->
<!-- ══════════════════════════════════════════════════════════════════════ -->

<!-- Code Cell -->
<ng-template #codeCell let-row>
  <div class="flex items-center gap-3">
    <div class="w-9 h-9 rounded-lg flex items-center justify-center bg-gradient-to-br from-cyan-400 to-blue-600 flex-shrink-0">
      <mat-icon class="text-white icon-size-5">badge</mat-icon>
    </div>
    <span class="text-sm font-semibold text-gray-900 dark:text-white">{{ row.code }}</span>
  </div>
</ng-template>

<!-- Name Cell -->
<ng-template #nameCell let-row>
  <div>
    <p class="text-sm font-medium text-gray-900 dark:text-white">{{ row.name }}</p>
    <p class="text-xs text-gray-500 dark:text-gray-400 flex items-center gap-1 mt-0.5">
      <mat-icon class="icon-size-3">event</mat-icon>
      {{ row.startDate | date:'MMM d, y' }} – {{ row.endDate | date:'MMM d, y' }}
    </p>
  </div>
</ng-template>

<!-- Start Date Cell -->
<ng-template #startDateCell let-row>
  <div class="flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300">
    <mat-icon class="icon-size-4 text-gray-500">event</mat-icon>
    <span>{{ row.startDate | date:'mediumDate' }}</span>
  </div>
</ng-template>

<!-- End Date Cell -->
<ng-template #endDateCell let-row>
  <div class="flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300">
    <mat-icon class="icon-size-4 text-gray-500">event</mat-icon>
    <span>{{ row.endDate | date:'mediumDate' }}</span>
  </div>
</ng-template>

<!-- Status Cell -->
<ng-template #statusCell let-row>
  <span
    class="px-3 py-1 rounded-full text-xs font-semibold"
    [ngClass]="{
      'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400': row.isCurrent,
      'bg-red-100   dark:bg-red-900/30   text-red-700   dark:text-red-400':   row.isClosed,
      'bg-blue-100  dark:bg-blue-900/30  text-blue-700  dark:text-blue-400':  !row.isCurrent && !row.isClosed
    }">
    {{ row.isCurrent ? 'Current' : (row.isClosed ? 'Closed' : 'Open') }}
  </span>
</ng-template>