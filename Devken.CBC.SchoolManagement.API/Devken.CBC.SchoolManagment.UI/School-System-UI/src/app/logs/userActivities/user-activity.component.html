<div class="absolute inset-0 flex min-w-0 flex-col overflow-y-auto" cdkScrollable>

  <!-- ── Page Header ─────────────────────────────────────────────────────── -->
  <app-page-header
    title="User Activity Log"
    description="Monitor and audit user actions across the system"
    icon="history"
    [breadcrumbs]="breadcrumbs"
    [actionTemplate]="headerActions">
  </app-page-header>

  <!-- Header Actions -->
  <ng-template #headerActions>
    <button mat-flat-button
      class="bg-white text-indigo-700 hover:bg-yellow-200 hover:text-indigo-900 shadow-lg transition-all hover:shadow-xl font-bold"
      (click)="loadAll()"
      [disabled]="isLoading">
      <mat-icon class="icon-size-5" [class.animate-spin]="isLoading">refresh</mat-icon>
      <span class="ml-2">Refresh</span>
    </button>
  </ng-template>

  <!-- ── Main Content ───────────────────────────────────────────────────── -->
  <div class="bg-card -mt-10 flex-auto rounded-t-2xl p-6 shadow sm:p-10">

    <!-- Stats Cards -->
    <app-stats-cards [cards]="statsCards" [columns]="4"></app-stats-cards>

    <!-- Filter Panel -->
    <div class="mb-6">
      <app-filter-panel
        [fields]="filterFields"
        [showPanel]="showFilterPanel"
        [columns]="4"
        (filterChange)="onFilterChange($event)"
        (clearAll)="onClearFilters()"
        (togglePanel)="toggleFilterPanel()">
      </app-filter-panel>
    </div>

    <!-- Data Table -->
<app-data-table
  [columns]="tableColumns"
  [data]="paginatedData"
  [loading]="isLoading"
  [header]="tableHeaderWithSubtitle"
  [emptyState]="tableEmptyState"
  [cellTemplates]="cellTemplates">
</app-data-table>



    <!-- Pagination -->
    <app-pagination
      *ngIf="!isLoading"
      [currentPage]="currentPage"
      [totalItems]="filteredData.length"
      [itemsPerPage]="itemsPerPage"
      [itemLabel]="'activities'"
      [showItemsPerPageSelector]="true"
      [showPageNumbers]="true"
      (pageChange)="onPageChange($event)"
      (itemsPerPageChange)="onItemsPerPageChange($event)">
    </app-pagination>

  </div>
</div>

<!-- ══════════════════════════════════════════════════════════════════════ -->
<!-- Cell Templates                                                         -->
<!-- ══════════════════════════════════════════════════════════════════════ -->

<!-- User Cell -->
<ng-template #userCell let-row>
  <div class="flex items-center gap-3">
    <div class="w-9 h-9 rounded-xl shrink-0 flex items-center justify-center
                bg-gradient-to-br from-indigo-100 to-violet-100
                border border-indigo-200 dark:border-indigo-800">
      <span class="text-xs font-bold text-indigo-600 dark:text-indigo-400">
        {{ getInitials(row.userFullName) }}
      </span>
    </div>
    <div class="min-w-0">
      <p class="text-sm font-semibold text-gray-900 dark:text-white truncate">
        {{ row.userFullName }}
      </p>
      <p class="text-xs text-gray-500 dark:text-gray-400 truncate">
        {{ row.userEmail }}
      </p>
    </div>
  </div>
</ng-template>

<!-- Activity Type Cell -->
<ng-template #typeCell let-row>
  <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg text-xs font-semibold"
    [ngClass]="getTypeBadgeClass(row.activityType)">
    <mat-icon class="icon-size-3.5">{{ getTypeIcon(row.activityType) }}</mat-icon>
{{ formatActivityType(row.activityType) }}

  </span>
</ng-template>

<!-- Details Cell -->
<ng-template #detailsCell let-row>
  <p class="text-sm text-gray-600 dark:text-gray-400 truncate max-w-xs"
     [matTooltip]="row.activityDetails"
     matTooltipPosition="above">
    {{ row.activityDetails || '—' }}
  </p>
</ng-template>

<!-- Time Cell -->
<ng-template #timeCell let-row>
  <div class="flex items-center gap-1.5 text-sm text-gray-600 dark:text-gray-400">
    <mat-icon class="icon-size-4 text-gray-400">schedule</mat-icon>
    <div>
      <p class="font-medium text-gray-800 dark:text-gray-200">{{ formatDate(row.createdOn) }}</p>
      <p class="text-xs text-gray-400">{{ formatTime(row.createdOn) }}</p>
    </div>
  </div>
</ng-template>
<!-- School Cell -->
<ng-template #schoolCell let-row>
  <div class="flex items-center gap-2">
    <mat-icon class="icon-size-4 text-indigo-500">school</mat-icon>
    <div class="min-w-0">
<p class="text-sm font-medium text-gray-800 dark:text-gray-200 truncate">
  {{ row.schoolName  }}
</p>

    </div>
  </div>
</ng-template>
