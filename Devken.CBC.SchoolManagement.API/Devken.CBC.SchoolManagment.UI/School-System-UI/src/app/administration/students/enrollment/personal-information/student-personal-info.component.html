<!-- Student Personal Information - Fuse/Material + Tailwind -->
<div class="max-w-6xl">

  <!-- Section Header -->
  <div class="flex items-start gap-4 mb-8">
    <div class="flex items-center justify-center w-14 h-14 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 shadow-lg">
      <mat-icon class="text-white !w-7 !h-7" svgIcon="heroicons_outline:user"></mat-icon>
    </div>
    <div class="flex-1">
      <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-1">Personal Information</h2>
      <p class="text-gray-600 dark:text-gray-400">Enter the student's core personal details. Fields marked * are required.</p>
    </div>
  </div>

  <form [formGroup]="form" novalidate class="space-y-8">

    <!-- ──────────────────────────────────────────────────────────────── -->
    <!-- Photo + Name Row -->
    <!-- ──────────────────────────────────────────────────────────────── -->
    <mat-card class="shadow-md">
      <mat-card-content class="!p-6">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
          
          <!-- Avatar uploader -->
          <div class="flex flex-col items-center">
            <div 
              class="relative w-32 h-32 rounded-full overflow-hidden bg-gray-100 dark:bg-gray-700 border-4 border-white dark:border-gray-800 shadow-lg mb-4"
              [class.ring-4]="photoPreview"
              [class.ring-indigo-200]="photoPreview"
              [class.dark:ring-indigo-800]="photoPreview">
              
              <img 
                *ngIf="photoPreview" 
                [src]="photoPreview" 
                alt="Student photo"
                class="w-full h-full object-cover">
              
              <div *ngIf="!photoPreview" class="flex flex-col items-center justify-center h-full text-gray-400">
                <mat-icon class="!w-12 !h-12 !text-5xl mb-2" svgIcon="heroicons_outline:user"></mat-icon>
                <span class="text-xs">No photo</span>
              </div>
            </div>
            
            <label class="cursor-pointer">
              <input 
                type="file" 
                accept="image/jpeg,image/png,image/webp" 
                hidden 
                (change)="onPhotoSelected($event)">
              <button 
                mat-stroked-button 
                color="primary"
                type="button"
                class="!text-sm"
                (click)="$event.preventDefault(); $event.target.previousElementSibling.click()">
                <mat-icon svgIcon="heroicons_outline:camera" class="mr-2"></mat-icon>
                Upload Photo
              </button>
            </label>
            
            <button 
              *ngIf="photoPreview" 
              mat-button 
              color="warn"
              type="button" 
              class="!text-xs !mt-2"
              (click)="removePhoto()">
              Remove
            </button>
            
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-2 text-center">JPG, PNG, WebP · Max 2 MB</p>
          </div>

          <!-- Name fields -->
          <div class="lg:col-span-3 grid grid-cols-1 md:grid-cols-2 gap-4">
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>First Name *</mat-label>
              <input matInput formControlName="firstName" placeholder="e.g. Amara">
              <mat-icon matPrefix svgIcon="heroicons_outline:user" class="text-gray-400"></mat-icon>
              <mat-error *ngIf="form.get('firstName')?.hasError('required')">First name is required</mat-error>
              <mat-error *ngIf="form.get('firstName')?.hasError('minlength')">Minimum 2 characters required</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Last Name *</mat-label>
              <input matInput formControlName="lastName" placeholder="e.g. Wanjiku">
              <mat-icon matPrefix svgIcon="heroicons_outline:user" class="text-gray-400"></mat-icon>
              <mat-error *ngIf="form.get('lastName')?.hasError('required')">Last name is required</mat-error>
              <mat-error *ngIf="form.get('lastName')?.hasError('minlength')">Minimum 2 characters required</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Middle Name</mat-label>
              <input matInput formControlName="middleName" placeholder="Optional">
              <mat-icon matPrefix svgIcon="heroicons_outline:user" class="text-gray-400"></mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Gender *</mat-label>
              <mat-select formControlName="gender">
                <mat-option value="">Select gender</mat-option>
                <mat-option *ngFor="let gender of genders$ | async" [value]="gender.value">
                  {{ gender.name }}
                </mat-option>
              </mat-select>
              <mat-icon matPrefix svgIcon="heroicons_outline:user-circle" class="text-gray-400"></mat-icon>
              <mat-error>Gender is required</mat-error>
            </mat-form-field>
          </div>

        </div>
      </mat-card-content>
    </mat-card>

    <!-- ──────────────────────────────────────────────────────────────── -->
    <!-- ID Numbers -->
    <!-- ──────────────────────────────────────────────────────────────── -->
    <mat-card class="shadow-md">
      <mat-card-header class="!pb-2">
        <mat-card-title class="!text-base !font-semibold flex items-center gap-2">
          <mat-icon svgIcon="heroicons_outline:identification" class="text-indigo-600"></mat-icon>
          Identification Numbers
        </mat-card-title>
      </mat-card-header>
      <mat-card-content class="!pt-4">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Admission Number *</mat-label>
            <input matInput formControlName="admissionNumber" placeholder="e.g. ADM/2024/001">
            <mat-icon matPrefix svgIcon="heroicons_outline:hashtag" class="text-gray-400"></mat-icon>
            <mat-error>Admission number is required</mat-error>
            <mat-hint>Must be unique within the school</mat-hint>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>NEMIS Number</mat-label>
            <input matInput type="number" formControlName="nemisNumber" placeholder="e.g. 12345678">
            <mat-icon matPrefix svgIcon="heroicons_outline:document-text" class="text-gray-400"></mat-icon>
            <mat-hint>National Education Management Information System</mat-hint>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Birth Certificate No.</mat-label>
            <input matInput formControlName="birthCertificateNumber" placeholder="e.g. BC/NBI/0000001">
            <mat-icon matPrefix svgIcon="heroicons_outline:document" class="text-gray-400"></mat-icon>
          </mat-form-field>

        </div>
      </mat-card-content>
    </mat-card>

    <!-- ──────────────────────────────────────────────────────────────── -->
    <!-- Personal Details -->
    <!-- ──────────────────────────────────────────────────────────────── -->
    <mat-card class="shadow-md">
      <mat-card-header class="!pb-2">
        <mat-card-title class="!text-base !font-semibold flex items-center gap-2">
          <mat-icon svgIcon="heroicons_outline:calendar" class="text-indigo-600"></mat-icon>
          Personal Details
        </mat-card-title>
      </mat-card-header>
      <mat-card-content class="!pt-4">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Date of Birth *</mat-label>
            <input matInput type="date" formControlName="dateOfBirth">
            <mat-icon matPrefix svgIcon="heroicons_outline:cake" class="text-gray-400"></mat-icon>
            <mat-error>Date of birth is required</mat-error>
            <mat-hint *ngIf="form.get('dateOfBirth')?.value && !isInvalid('dateOfBirth')">
              Age: {{ calculateAge(form.get('dateOfBirth')?.value) }}
            </mat-hint>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Religion</mat-label>
            <mat-select formControlName="religion">
              <mat-option value="">Select religion</mat-option>
              <mat-option value="Christianity">Christianity</mat-option>
              <mat-option value="Islam">Islam</mat-option>
              <mat-option value="Hinduism">Hinduism</mat-option>
              <mat-option value="Other">Other</mat-option>
              <mat-option value="None">None / Not specified</mat-option>
            </mat-select>
            <mat-icon matPrefix svgIcon="heroicons_outline:book-open" class="text-gray-400"></mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Nationality</mat-label>
            <input matInput formControlName="nationality" placeholder="Kenyan">
            <mat-icon matPrefix svgIcon="heroicons_outline:flag" class="text-gray-400"></mat-icon>
          </mat-form-field>

        </div>
      </mat-card-content>
    </mat-card>

    <!-- ──────────────────────────────────────────────────────────────── -->
    <!-- Academic Classification -->
    <!-- ──────────────────────────────────────────────────────────────── -->
    <mat-card class="shadow-md">
      <mat-card-header class="!pb-2">
        <mat-card-title class="!text-base !font-semibold flex items-center gap-2">
          <mat-icon svgIcon="heroicons_outline:academic-cap" class="text-indigo-600"></mat-icon>
          Academic Classification
        </mat-card-title>
      </mat-card-header>
      <mat-card-content class="!pt-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Student Status *</mat-label>
            <mat-select formControlName="studentStatus">
              <mat-option value="">Select status</mat-option>
              <mat-option *ngFor="let status of studentStatuses$ | async" [value]="status.value">
                {{ status.name }}
              </mat-option>
            </mat-select>
            <mat-icon matPrefix svgIcon="heroicons_outline:clipboard-check" class="text-gray-400"></mat-icon>
            <mat-error>Student status is required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>CBC Level *</mat-label>
            <mat-select formControlName="cbcLevel">
              <mat-option value="">Select level</mat-option>
              <mat-option *ngFor="let level of cbcLevels$ | async" [value]="level.value">
                {{ level.name }}
              </mat-option>
            </mat-select>
            <mat-icon matPrefix svgIcon="heroicons_outline:chart-bar" class="text-gray-400"></mat-icon>
            <mat-error>CBC level is required</mat-error>
          </mat-form-field>

        </div>
      </mat-card-content>
    </mat-card>

    <!-- ──────────────────────────────────────────────────────────────── -->
    <!-- Admission Details -->
    <!-- ──────────────────────────────────────────────────────────────── -->
    <mat-card class="shadow-md">
      <mat-card-header class="!pb-2">
        <mat-card-title class="!text-base !font-semibold flex items-center gap-2">
          <mat-icon svgIcon="heroicons_outline:document-plus" class="text-indigo-600"></mat-icon>
          Admission Details
        </mat-card-title>
      </mat-card-header>
      <mat-card-content class="!pt-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Date of Admission *</mat-label>
            <input matInput type="date" formControlName="dateOfAdmission">
            <mat-icon matPrefix svgIcon="heroicons_outline:calendar-days" class="text-gray-400"></mat-icon>
            <mat-error>Date of admission is required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Photo URL</mat-label>
            <input matInput type="url" formControlName="photoUrl" placeholder="https://...">
            <mat-icon matPrefix svgIcon="heroicons_outline:link" class="text-gray-400"></mat-icon>
            <mat-hint>Or use the photo uploader above</mat-hint>
          </mat-form-field>

        </div>

        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Notes</mat-label>
          <textarea matInput formControlName="notes" rows="3" placeholder="Any additional notes about this student…"></textarea>
          <mat-hint>Optional additional information</mat-hint>
        </mat-form-field>
      </mat-card-content>
    </mat-card>

    <!-- ──────────────────────────────────────────────────────────────── -->
    <!-- Active Status -->
    <!-- ──────────────────────────────────────────────────────────────── -->
    <mat-card class="shadow-md">
      <mat-card-content class="!p-6">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-4">
            <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-green-100 dark:bg-green-900/20">
              <mat-icon class="text-green-600" svgIcon="heroicons_outline:check-circle"></mat-icon>
            </div>
            <div>
              <div class="font-semibold text-gray-900 dark:text-white">Student is Active</div>
              <div class="text-sm text-gray-600 dark:text-gray-400">Inactive students are hidden from most views</div>
            </div>
          </div>
          <mat-slide-toggle formControlName="isActive" color="primary"></mat-slide-toggle>
        </div>
      </mat-card-content>
    </mat-card>

  </form>

</div>