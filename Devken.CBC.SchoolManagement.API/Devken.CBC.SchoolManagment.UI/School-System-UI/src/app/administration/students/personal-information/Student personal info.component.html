<!-- ══════════════════════════════════════════════════════════════════ -->
<!-- Student Personal Information - Responsive Form -->
<!-- ══════════════════════════════════════════════════════════════════ -->

<div class="section-header">
  <div class="section-icon-row">
    <div class="section-icon" role="img" aria-label="Personal information">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/>
        <circle cx="12" cy="7" r="4"/>
      </svg>
    </div>
    <div>
      <h2 class="section-title">Personal Information</h2>
      <p class="section-subtitle">Enter the student's core personal details. Fields marked * are required.</p>
    </div>
  </div>
</div>

<form [formGroup]="form" novalidate aria-label="Student personal information form">

  <!-- ──────────────────────────────────────────────────────────────── -->
  <!-- Photo + Name Row -->
  <!-- ──────────────────────────────────────────────────────────────── -->
  <div class="photo-name-row">
    
    <!-- Avatar uploader -->
    <div class="avatar-block">
      <div 
        class="avatar-preview" 
        [style.backgroundImage]="photoPreview ? 'url(' + photoPreview + ')' : null"
        [class.has-photo]="photoPreview"
        role="img"
        [attr.aria-label]="photoPreview ? 'Student photo preview' : 'No photo uploaded'">
        <ng-container *ngIf="!photoPreview">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/>
            <circle cx="12" cy="7" r="4"/>
          </svg>
          <span>No photo</span>
        </ng-container>
      </div>
      
      <label class="avatar-upload-btn" for="photoInput">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
          <polyline points="17 8 12 3 7 8"/>
          <line x1="12" y1="3" x2="12" y2="15"/>
        </svg>
        Upload Photo
      </label>
      
      <input 
        id="photoInput" 
        type="file" 
        accept="image/jpeg,image/png,image/webp" 
        hidden 
        (change)="onPhotoSelected($event)"
        aria-label="Upload student photo">
      
      <button 
        *ngIf="photoPreview" 
        class="avatar-remove" 
        type="button" 
        (click)="removePhoto()"
        aria-label="Remove uploaded photo">
        Remove
      </button>
      
      <p class="form-hint">JPG, PNG, WebP · Max 2 MB</p>
    </div>

    <!-- Name fields -->
    <div class="form-grid cols-2 name-fields">
      <div class="form-group">
        <label class="form-label" for="firstName">
          First Name <span class="required" aria-label="required">*</span>
        </label>
        <input 
          id="firstName"
          class="form-input" 
          formControlName="firstName" 
          placeholder="e.g. Amara"
          [class.error]="isInvalid('firstName')"
          aria-required="true"
          [attr.aria-invalid]="isInvalid('firstName')"
          [attr.aria-describedby]="isInvalid('firstName') ? 'firstName-error' : null">
        <span 
          *ngIf="isInvalid('firstName')" 
          class="field-error" 
          id="firstName-error"
          role="alert">
          {{ getErrorMessage('firstName') }}
        </span>
      </div>

      <div class="form-group">
        <label class="form-label" for="lastName">
          Last Name <span class="required" aria-label="required">*</span>
        </label>
        <input 
          id="lastName"
          class="form-input" 
          formControlName="lastName" 
          placeholder="e.g. Wanjiku"
          [class.error]="isInvalid('lastName')"
          aria-required="true"
          [attr.aria-invalid]="isInvalid('lastName')"
          [attr.aria-describedby]="isInvalid('lastName') ? 'lastName-error' : null">
        <span 
          *ngIf="isInvalid('lastName')" 
          class="field-error" 
          id="lastName-error"
          role="alert">
          {{ getErrorMessage('lastName') }}
        </span>
      </div>

      <div class="form-group">
        <label class="form-label" for="middleName">Middle Name</label>
        <input 
          id="middleName"
          class="form-input" 
          formControlName="middleName" 
          placeholder="Optional">
      </div>

      <div class="form-group">
        <label class="form-label" for="gender">
          Gender <span class="required" aria-label="required">*</span>
        </label>
        <select
          id="gender"
          class="form-select"
          formControlName="gender"
          [class.error]="isInvalid('gender')"
          aria-required="true"
          [attr.aria-invalid]="isInvalid('gender')"
          [attr.aria-describedby]="isInvalid('gender') ? 'gender-error' : null"
        >
          <option value="">Select gender</option>
          <ng-container *ngIf="genders$ | async as genders">
            <option *ngFor="let gender of genders" [value]="gender.value">{{ gender.name }}</option>
          </ng-container>
        </select>
        <span
          *ngIf="isInvalid('gender')"
          class="field-error"
          id="gender-error"
          role="alert"
        >
          {{ getErrorMessage('gender') }}
        </span>
      </div>

    </div>
  </div>

  <!-- ──────────────────────────────────────────────────────────────── -->
  <!-- ID Numbers -->
  <!-- ──────────────────────────────────────────────────────────────── -->
  <div class="subsection">
    <h3 class="subsection-title">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <rect x="2" y="5" width="20" height="14" rx="2"/>
        <line x1="2" y1="10" x2="22" y2="10"/>
      </svg>
      Identification Numbers
    </h3>
    
    <div class="form-grid cols-3">
      <div class="form-group">
        <label class="form-label" for="admissionNumber">
          Admission Number <span class="required" aria-label="required">*</span>
        </label>
        <input 
          id="admissionNumber"
          class="form-input" 
          formControlName="admissionNumber" 
          placeholder="e.g. ADM/2024/001"
          [class.error]="isInvalid('admissionNumber')"
          aria-required="true"
          [attr.aria-invalid]="isInvalid('admissionNumber')"
          [attr.aria-describedby]="isInvalid('admissionNumber') ? 'admissionNumber-error admissionNumber-hint' : 'admissionNumber-hint'">
        <span 
          *ngIf="isInvalid('admissionNumber')" 
          class="field-error" 
          id="admissionNumber-error"
          role="alert">
          {{ getErrorMessage('admissionNumber') }}
        </span>
        <span class="form-hint" id="admissionNumber-hint">Must be unique within the school</span>
      </div>

      <div class="form-group">
        <label class="form-label" for="nemisNumber">NEMIS Number</label>
        <input 
          id="nemisNumber"
          class="form-input" 
          formControlName="nemisNumber" 
          placeholder="e.g. 12345678"
          aria-describedby="nemisNumber-hint">
        <span class="form-hint" id="nemisNumber-hint">National Education Management Information System</span>
      </div>

      <div class="form-group">
        <label class="form-label" for="birthCertificateNumber">Birth Certificate No.</label>
        <input 
          id="birthCertificateNumber"
          class="form-input" 
          formControlName="birthCertificateNumber" 
          placeholder="e.g. BC/NBI/0000001">
      </div>
    </div>
  </div>

  <!-- ──────────────────────────────────────────────────────────────── -->
  <!-- Personal Details -->
  <!-- ──────────────────────────────────────────────────────────────── -->
  <div class="subsection">
    <h3 class="subsection-title">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
        <line x1="16" y1="2" x2="16" y2="6"/>
        <line x1="8" y1="2" x2="8" y2="6"/>
        <line x1="3" y1="10" x2="21" y2="10"/>
      </svg>
      Personal Details
    </h3>
    
    <div class="form-grid cols-3">
      <div class="form-group">
        <label class="form-label" for="dateOfBirth">
          Date of Birth <span class="required" aria-label="required">*</span>
        </label>
        <input 
          id="dateOfBirth"
          class="form-input" 
          type="date" 
          formControlName="dateOfBirth"
          [class.error]="isInvalid('dateOfBirth')"
          aria-required="true"
          [attr.aria-invalid]="isInvalid('dateOfBirth')"
          [attr.aria-describedby]="isInvalid('dateOfBirth') ? 'dateOfBirth-error' : (form.get('dateOfBirth')?.value ? 'dateOfBirth-age' : null)">
        <span 
          *ngIf="isInvalid('dateOfBirth')" 
          class="field-error" 
          id="dateOfBirth-error"
          role="alert">
          {{ getErrorMessage('dateOfBirth') }}
        </span>
        <span 
          *ngIf="form.get('dateOfBirth')?.value && !isInvalid('dateOfBirth')" 
          class="form-hint" 
          id="dateOfBirth-age">
          Age: {{ calculateAge(form.get('dateOfBirth')?.value) }}
        </span>
      </div>

      <div class="form-group">
        <label class="form-label" for="religion">Religion</label>
        <select id="religion" class="form-select" formControlName="religion">
          <option value="">Select religion</option>
          <option value="Christianity">Christianity</option>
          <option value="Islam">Islam</option>
          <option value="Hinduism">Hinduism</option>
          <option value="Other">Other</option>
          <option value="None">None / Not specified</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label" for="nationality">Nationality</label>
        <input 
          id="nationality"
          class="form-input" 
          formControlName="nationality" 
          placeholder="Kenyan">
      </div>
    </div>
  </div>

  <!-- ──────────────────────────────────────────────────────────────── -->
  <!-- Admission Details -->
  <!-- ──────────────────────────────────────────────────────────────── -->
  <div class="subsection">
    <h3 class="subsection-title">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
        <polyline points="14 2 14 8 20 8"/>
      </svg>
      Admission Details
    </h3>
    
    <div class="form-grid cols-2">
      <div class="form-group">
        <label class="form-label" for="dateOfAdmission">
          Date of Admission <span class="required" aria-label="required">*</span>
        </label>
        <input 
          id="dateOfAdmission"
          class="form-input" 
          type="date" 
          formControlName="dateOfAdmission"
          [class.error]="isInvalid('dateOfAdmission')"
          aria-required="true"
          [attr.aria-invalid]="isInvalid('dateOfAdmission')"
          [attr.aria-describedby]="isInvalid('dateOfAdmission') ? 'dateOfAdmission-error' : null">
        <span 
          *ngIf="isInvalid('dateOfAdmission')" 
          class="field-error" 
          id="dateOfAdmission-error"
          role="alert">
          {{ getErrorMessage('dateOfAdmission') }}
        </span>
      </div>

      <div class="form-group">
        <label class="form-label" for="photoUrl">Photo URL</label>
        <input 
          id="photoUrl"
          class="form-input" 
          formControlName="photoUrl" 
          placeholder="https://..."
          type="url"
          aria-describedby="photoUrl-hint">
        <span class="form-hint" id="photoUrl-hint">Or use the photo uploader above</span>
      </div>
    </div>

    <div class="form-group span-full" style="margin-top: 1rem;">
      <label class="form-label" for="notes">Notes</label>
      <textarea 
        id="notes"
        class="form-textarea" 
        formControlName="notes" 
        rows="3"
        placeholder="Any additional notes about this student…"
        aria-describedby="notes-hint"></textarea>
      <span class="form-hint" id="notes-hint">Optional additional information</span>
    </div>
  </div>

  <!-- ──────────────────────────────────────────────────────────────── -->
  <!-- Active Status -->
  <!-- ──────────────────────────────────────────────────────────────── -->
  <div class="subsection">
    <label class="toggle-row" for="isActiveToggle">
      <input 
        class="toggle" 
        id="isActiveToggle" 
        type="checkbox" 
        formControlName="isActive"
        role="switch"
        [attr.aria-checked]="form.get('isActive')?.value">
      <div>
        <div class="toggle-label">Student is Active</div>
        <div class="toggle-sub">Inactive students are hidden from most views</div>
      </div>
    </label>
  </div>

</form>