<!-- assessment-details-step/assessment-details-step.component.html -->
<div class="max-w-6xl">

  <!-- Section Header -->
  <div class="flex items-start gap-4 mb-8">
    <div
      class="flex items-center justify-center w-14 h-14 rounded-xl shadow-lg"
      [ngClass]="{
        'bg-gradient-to-br from-indigo-500 to-blue-600':  getTypeColor(assessmentType) === 'indigo',
        'bg-gradient-to-br from-violet-500 to-purple-600':getTypeColor(assessmentType) === 'violet',
        'bg-gradient-to-br from-teal-500 to-emerald-600': getTypeColor(assessmentType) === 'teal'
      }">
      <mat-icon class="text-white !w-7 !h-7">tune</mat-icon>
    </div>
    <div class="flex-1">
      <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-1">
        {{ typeLabel }} Settings
      </h2>
      <p class="text-gray-600 dark:text-gray-400">
        These optional fields are specific to {{ typeLabel }} assessments. Skip any that don't apply.
      </p>
    </div>
  </div>

  <fuse-alert type="info" appearance="soft" [showIcon]="true" class="mb-6">
    All fields on this step are <strong>optional</strong>. You can complete the assessment with just the required fields from the previous step.
  </fuse-alert>

  <form [formGroup]="form" novalidate class="space-y-6">

    <!-- ══════════════════════════════════════════════════════════════ -->
    <!-- FORMATIVE FIELDS                                              -->
    <!-- ══════════════════════════════════════════════════════════════ -->
    <ng-container *ngIf="assessmentType === AssessmentType.Formative">

      <!-- Type + Competency Area -->
      <mat-card class="shadow-md">
        <mat-card-header class="!pb-2">
          <mat-card-title class="!text-base !font-semibold flex items-center gap-2">
            <mat-icon class="text-indigo-600">assignment</mat-icon>
            Formative Type & Competency
          </mat-card-title>
        </mat-card-header>
        <mat-card-content class="!pt-4">
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">

            <!-- Formative Type visual picker -->
            <div class="sm:col-span-2">
              <p class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Formative Type</p>
              <div class="flex flex-wrap gap-2">
                <div
                  *ngFor="let t of formativeTypes"
                  class="flex items-center gap-1.5 rounded-lg border-2 cursor-pointer
                         px-3 py-2 text-sm font-medium transition-all"
                  [ngClass]="{
                    'border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20 text-indigo-700 dark:text-indigo-300': form.get('formativeType')?.value === t.value,
                    'border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-400 hover:border-indigo-300': form.get('formativeType')?.value !== t.value
                  }"
                  (click)="form.get('formativeType')?.setValue(t.value)">
                  <mat-icon class="!w-4 !h-4 !text-base">{{ t.icon }}</mat-icon>
                  {{ t.label }}
                </div>
              </div>
            </div>

            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Competency Area</mat-label>
              <input matInput formControlName="competencyArea" placeholder="e.g. Communication & Collaboration">
              <mat-icon matPrefix class="text-gray-400">hub</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Learning Outcome</mat-label>
              <mat-select formControlName="learningOutcomeId">
                <mat-option [value]="null">None</mat-option>
                <mat-option *ngFor="let o of outcomes" [value]="o.id">{{ o.outcome }}</mat-option>
              </mat-select>
              <mat-icon matPrefix class="text-gray-400">flag</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Strand</mat-label>
              <input matInput formControlName="formativeStrand" placeholder="e.g. Listening & Speaking">
              <mat-icon matPrefix class="text-gray-400">account_tree</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Sub-Strand</mat-label>
              <input matInput formControlName="formativeSubStrand" placeholder="e.g. Phonological Awareness">
              <mat-icon matPrefix class="text-gray-400">device_hub</mat-icon>
            </mat-form-field>

          </div>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Assessment Criteria</mat-label>
            <textarea matInput formControlName="criteria" rows="3"
              placeholder="What will you observe or measure? Enter criteria here..."></textarea>
            <mat-icon matPrefix class="text-gray-400">checklist</mat-icon>
          </mat-form-field>

        </mat-card-content>
      </mat-card>

      <!-- Rubric & Weight -->
      <mat-card class="shadow-md">
        <mat-card-header class="!pb-2">
          <mat-card-title class="!text-base !font-semibold flex items-center gap-2">
            <mat-icon class="text-indigo-600">score</mat-icon>
            Rubric & Weight
          </mat-card-title>
        </mat-card-header>
        <mat-card-content class="!pt-4 space-y-4">

          <div class="flex items-center justify-between p-4 rounded-xl
                      bg-indigo-50 dark:bg-indigo-900/10 border border-indigo-200 dark:border-indigo-800">
            <div class="flex items-center gap-3">
              <div class="flex items-center justify-center w-10 h-10 rounded-lg
                          bg-indigo-100 dark:bg-indigo-900/30">
                <mat-icon class="text-indigo-600">table_chart</mat-icon>
              </div>
              <div>
                <div class="font-semibold text-gray-900 dark:text-white text-sm">Requires Rubric</div>
                <div class="text-xs text-gray-600 dark:text-gray-400">Attach a scoring rubric to this assessment</div>
              </div>
            </div>
            <mat-slide-toggle formControlName="requiresRubric" color="primary"></mat-slide-toggle>
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Assessment Weight (%)</mat-label>
              <input matInput type="number" formControlName="assessmentWeight" min="0" max="100">
              <mat-icon matPrefix class="text-gray-400">percent</mat-icon>
              <mat-hint>Contribution to overall term grade</mat-hint>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Feedback Template</mat-label>
              <input matInput formControlName="feedbackTemplate" placeholder="e.g. Excellent / Good / Needs improvement">
              <mat-icon matPrefix class="text-gray-400">rate_review</mat-icon>
            </mat-form-field>
          </div>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Instructions for Assessor</mat-label>
            <textarea matInput formControlName="formativeInstructions" rows="2"
              placeholder="Internal notes or instructions for the teacher..."></textarea>
            <mat-icon matPrefix class="text-gray-400">notes</mat-icon>
          </mat-form-field>

        </mat-card-content>
      </mat-card>

    </ng-container>

    <!-- ══════════════════════════════════════════════════════════════ -->
    <!-- SUMMATIVE FIELDS                                              -->
    <!-- ══════════════════════════════════════════════════════════════ -->
    <ng-container *ngIf="assessmentType === AssessmentType.Summative">

      <!-- Exam type picker -->
      <mat-card class="shadow-md">
        <mat-card-header class="!pb-2">
          <mat-card-title class="!text-base !font-semibold flex items-center gap-2">
            <mat-icon class="text-violet-600">school</mat-icon>
            Exam Type
          </mat-card-title>
        </mat-card-header>
        <mat-card-content class="!pt-4">

          <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3 mb-4">
            <div
              *ngFor="let e of examTypes"
              class="relative rounded-xl border-2 cursor-pointer p-3 transition-all text-center"
              [ngClass]="{
                'border-violet-500 bg-violet-50 dark:bg-violet-900/20 shadow-md': form.get('examType')?.value === e.value,
                'border-gray-200 dark:border-gray-700 hover:border-violet-300': form.get('examType')?.value !== e.value
              }"
              (click)="form.get('examType')?.setValue(e.value)">
              <mat-icon
                class="!w-6 !h-6 mb-1 mx-auto block"
                [ngClass]="form.get('examType')?.value === e.value ? 'text-violet-600' : 'text-gray-400'">
                {{ e.icon }}
              </mat-icon>
              <span
                class="text-xs font-semibold"
                [ngClass]="form.get('examType')?.value === e.value ? 'text-violet-700 dark:text-violet-300' : 'text-gray-600 dark:text-gray-400'">
                {{ e.label }}
              </span>
              <div
                *ngIf="form.get('examType')?.value === e.value"
                class="absolute top-1.5 right-1.5 w-4 h-4 rounded-full bg-violet-600 flex items-center justify-center">
                <mat-icon class="!w-3 !h-3 !text-xs text-white">check</mat-icon>
              </div>
            </div>
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">

            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Duration (e.g. 2 hours 30 minutes)</mat-label>
              <input matInput formControlName="duration" placeholder="02:30:00">
              <mat-icon matPrefix class="text-gray-400">timer</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Number of Questions</mat-label>
              <input matInput type="number" formControlName="numberOfQuestions" min="1">
              <mat-icon matPrefix class="text-gray-400">format_list_numbered</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Pass Mark (%)</mat-label>
              <input matInput type="number" formControlName="passMark" min="0" max="100">
              <mat-icon matPrefix class="text-gray-400">percent</mat-icon>
            </mat-form-field>

          </div>
        </mat-card-content>
      </mat-card>

      <!-- Practical Component -->
      <mat-card class="shadow-md">
        <mat-card-header class="!pb-2">
          <mat-card-title class="!text-base !font-semibold flex items-center gap-2">
            <mat-icon class="text-violet-600">science</mat-icon>
            Practical Component
          </mat-card-title>
        </mat-card-header>
        <mat-card-content class="!pt-4 space-y-4">

          <div class="flex items-center justify-between p-4 rounded-xl
                      bg-violet-50 dark:bg-violet-900/10 border border-violet-200 dark:border-violet-800">
            <div class="flex items-center gap-3">
              <div class="flex items-center justify-center w-10 h-10 rounded-lg
                          bg-violet-100 dark:bg-violet-900/30">
                <mat-icon class="text-violet-600">science</mat-icon>
              </div>
              <div>
                <div class="font-semibold text-gray-900 dark:text-white text-sm">Has Practical Component</div>
                <div class="text-xs text-gray-600 dark:text-gray-400">Exam includes a practical/lab section</div>
              </div>
            </div>
            <mat-slide-toggle formControlName="hasPracticalComponent" color="primary"></mat-slide-toggle>
          </div>

          <div *ngIf="hasPractical" class="grid grid-cols-1 sm:grid-cols-2 gap-4">

            <div>
              <label class="text-xs font-medium text-gray-500 dark:text-gray-400 mb-2 block">
                Practical Weight: <strong>{{ form.get('practicalWeight')?.value }}%</strong>
              </label>
              <input
                type="range" min="0" max="100"
                [value]="form.get('practicalWeight')?.value"
                (input)="onPracticalWeightChange(+$any($event.target).value)"
                class="w-full h-2 rounded-lg appearance-none cursor-pointer bg-violet-200 accent-violet-600">
              <div class="flex justify-between text-xs text-gray-400 mt-1">
                <span>0%</span><span>50%</span><span>100%</span>
              </div>
            </div>

            <div class="flex flex-col gap-3">
              <div class="rounded-lg bg-violet-50 dark:bg-violet-900/10 border border-violet-200 dark:border-violet-800 p-3 text-center">
                <p class="text-xs text-gray-500 dark:text-gray-400">Theory Weight</p>
                <p class="text-2xl font-bold text-violet-700 dark:text-violet-300">
                  {{ form.get('theoryWeight')?.value }}%
                </p>
              </div>
              <div class="rounded-lg bg-indigo-50 dark:bg-indigo-900/10 border border-indigo-200 dark:border-indigo-800 p-3 text-center">
                <p class="text-xs text-gray-500 dark:text-gray-400">Practical Weight</p>
                <p class="text-2xl font-bold text-indigo-700 dark:text-indigo-300">
                  {{ form.get('practicalWeight')?.value }}%
                </p>
              </div>
            </div>

          </div>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Instructions for Students</mat-label>
            <textarea matInput formControlName="summativeInstructions" rows="2"
              placeholder="General instructions shown to students..."></textarea>
            <mat-icon matPrefix class="text-gray-400">notes</mat-icon>
          </mat-form-field>

        </mat-card-content>
      </mat-card>

    </ng-container>

    <!-- ══════════════════════════════════════════════════════════════ -->
    <!-- COMPETENCY FIELDS                                             -->
    <!-- ══════════════════════════════════════════════════════════════ -->
    <ng-container *ngIf="assessmentType === AssessmentType.Competency">

      <!-- Competency & Strand -->
      <mat-card class="shadow-md">
        <mat-card-header class="!pb-2">
          <mat-card-title class="!text-base !font-semibold flex items-center gap-2">
            <mat-icon class="text-teal-600">verified_user</mat-icon>
            Competency & CBC Alignment
          </mat-card-title>
        </mat-card-header>
        <mat-card-content class="!pt-4">
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">

            <mat-form-field appearance="outline" class="w-full sm:col-span-2">
              <mat-label>Competency Name</mat-label>
              <input matInput formControlName="competencyName"
                placeholder="e.g. Critical Thinking & Problem Solving">
              <mat-icon matPrefix class="text-gray-400">verified_user</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-full">
              <mat-label>CBC Strand</mat-label>
              <input matInput formControlName="competencyStrand" placeholder="e.g. Communication">
              <mat-icon matPrefix class="text-gray-400">account_tree</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-full">
              <mat-label>CBC Sub-Strand</mat-label>
              <input matInput formControlName="competencySubStrand" placeholder="e.g. Listening">
              <mat-icon matPrefix class="text-gray-400">device_hub</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-full sm:col-span-2">
              <mat-label>Specific Learning Outcome</mat-label>
              <input matInput formControlName="specificLearningOutcome"
                placeholder="e.g. Learner can identify the main idea of a spoken text">
              <mat-icon matPrefix class="text-gray-400">flag</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-full sm:col-span-2">
              <mat-label>Performance Indicators</mat-label>
              <textarea matInput formControlName="performanceIndicators" rows="2"
                placeholder="Observable behaviours indicating competency achievement..."></textarea>
              <mat-icon matPrefix class="text-gray-400">checklist</mat-icon>
            </mat-form-field>

          </div>
        </mat-card-content>
      </mat-card>

      <!-- Method & Rating -->
      <mat-card class="shadow-md">
        <mat-card-header class="!pb-2">
          <mat-card-title class="!text-base !font-semibold flex items-center gap-2">
            <mat-icon class="text-teal-600">rate_review</mat-icon>
            Assessment Method & Rating
          </mat-card-title>
        </mat-card-header>
        <mat-card-content class="!pt-4 space-y-4">

          <!-- Method picker chips -->
          <div>
            <p class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Assessment Method</p>
            <div class="flex flex-wrap gap-2">
              <div
                *ngFor="let m of assessmentMethods"
                class="flex items-center gap-1.5 rounded-lg border-2 cursor-pointer
                       px-3 py-2 text-sm font-medium transition-all"
                [ngClass]="{
                  'border-teal-500 bg-teal-50 dark:bg-teal-900/20 text-teal-700 dark:text-teal-300': form.get('assessmentMethod')?.value === m.value,
                  'border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-400 hover:border-teal-300': form.get('assessmentMethod')?.value !== m.value
                }"
                (click)="form.get('assessmentMethod')?.setValue(m.value)">
                <mat-icon class="!w-4 !h-4 !text-base">{{ m.icon }}</mat-icon>
                {{ m.label }}
              </div>
            </div>
          </div>

          <!-- Rating Scale -->
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Rating Scale</mat-label>
            <mat-select formControlName="ratingScale">
              <mat-option [value]="null">Select rating scale</mat-option>
              <mat-option *ngFor="let r of ratingScales" [value]="r.value">{{ r.label }}</mat-option>
            </mat-select>
            <mat-icon matPrefix class="text-gray-400">stars</mat-icon>
          </mat-form-field>

          <!-- Observation toggle -->
          <div class="flex items-center justify-between p-4 rounded-xl
                      bg-teal-50 dark:bg-teal-900/10 border border-teal-200 dark:border-teal-800">
            <div class="flex items-center gap-3">
              <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-teal-100 dark:bg-teal-900/30">
                <mat-icon class="text-teal-600">visibility</mat-icon>
              </div>
              <div>
                <div class="font-semibold text-gray-900 dark:text-white text-sm">Observation-Based</div>
                <div class="text-xs text-gray-600 dark:text-gray-400">Teacher observes and records competency evidence</div>
              </div>
            </div>
            <mat-slide-toggle formControlName="isObservationBased" color="primary"></mat-slide-toggle>
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Tools / Resources Required</mat-label>
              <input matInput formControlName="toolsRequired" placeholder="e.g. Ruler, calculator, notebook">
              <mat-icon matPrefix class="text-gray-400">build</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Assessor Instructions</mat-label>
              <input matInput formControlName="competencyInstructions" placeholder="Notes for the assessor">
              <mat-icon matPrefix class="text-gray-400">notes</mat-icon>
            </mat-form-field>
          </div>

        </mat-card-content>
      </mat-card>

    </ng-container>

  </form>
</div>