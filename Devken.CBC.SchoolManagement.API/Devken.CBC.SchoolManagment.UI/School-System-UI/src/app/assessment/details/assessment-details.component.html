<!-- details/assessment-details.component.html -->
<div class="absolute inset-0 flex min-w-0 flex-col overflow-y-auto" cdkScrollable>

  <!-- ── Page Header ─────────────────────────────────────────────────────── -->
  <app-page-header
    [title]="assessment?.title || 'Assessment Details'"
    [description]="assessment ? (getTypeName(assessmentType) + ' Assessment') : 'Loading...'"
    icon="assignment"
    [breadcrumbs]="breadcrumbs"
    [actionTemplate]="headerActions">
  </app-page-header>

  <ng-template #headerActions>
    <button mat-stroked-button class="mr-3" (click)="goBack()">
      <mat-icon class="icon-size-5">arrow_back</mat-icon>
      <span class="ml-2">Back to List</span>
    </button>

    <button mat-stroked-button class="mr-3"
      [ngClass]="{
        'border-teal-300 text-teal-700 hover:bg-teal-50': true
      }"
      [disabled]="!assessment"
      (click)="goToScores()">
      <mat-icon class="icon-size-5">grade</mat-icon>
      <span class="ml-2">Scores</span>
    </button>

    <button mat-flat-button class="mr-3"
      [ngClass]="{
        'bg-indigo-600 text-white hover:bg-indigo-700': getTypeColor(assessmentType) === 'indigo',
        'bg-violet-600 text-white hover:bg-violet-700': getTypeColor(assessmentType) === 'violet',
        'bg-teal-600   text-white hover:bg-teal-700':   getTypeColor(assessmentType) === 'teal'
      }"
      [disabled]="!assessment"
      (click)="editAssessment()">
      <mat-icon class="icon-size-5">edit</mat-icon>
      <span class="ml-2">Edit</span>
    </button>

    <button mat-icon-button [matMenuTriggerFor]="actionsMenu" [disabled]="!assessment"
      class="text-gray-600 dark:text-gray-400">
      <mat-icon>more_vert</mat-icon>
    </button>

    <mat-menu #actionsMenu="matMenu">
      <button mat-menu-item (click)="publishAssessment()" *ngIf="!assessment?.isPublished">
        <mat-icon class="text-green-600">public</mat-icon>
        <span>Publish Assessment</span>
      </button>
      <mat-divider *ngIf="!assessment?.isPublished"></mat-divider>
      <button mat-menu-item (click)="deleteAssessment()" [disabled]="assessment?.isPublished">
        <mat-icon class="text-red-600">delete</mat-icon>
        <span class="text-red-600">Delete Assessment</span>
      </button>
    </mat-menu>
  </ng-template>

  <!-- ── Main Content ─────────────────────────────────────────────────────── -->
  <div class="bg-card -mt-10 flex-auto rounded-t-2xl p-6 shadow sm:p-10">

    <!-- Loading -->
    <div *ngIf="isLoading" class="flex items-center justify-center py-32">
      <div class="text-center">
        <mat-spinner diameter="48" class="mx-auto mb-4"></mat-spinner>
        <p class="text-sm text-gray-500 dark:text-gray-400">Loading assessment details...</p>
      </div>
    </div>

    <!-- Content -->
    <div *ngIf="!isLoading && assessment" class="animate-fade-in">

      <!-- ── Hero Card ──────────────────────────────────────────────────── -->
      <div class="mb-8 overflow-hidden rounded-2xl border border-gray-200 shadow-lg dark:border-gray-700">
        <div
          class="px-8 py-6 bg-gradient-to-r"
          [ngClass]="{
            'from-indigo-600 via-violet-600 to-purple-700': getTypeColor(assessmentType) === 'indigo',
            'from-violet-600 via-purple-600 to-fuchsia-700': getTypeColor(assessmentType) === 'violet',
            'from-teal-600 via-emerald-600 to-green-700':    getTypeColor(assessmentType) === 'teal'
          }">
          <div class="flex flex-col items-center gap-6 md:flex-row">

            <!-- Icon -->
            <div class="flex items-center justify-center w-24 h-24 rounded-2xl
                        bg-white/20 backdrop-blur-sm border-4 border-white/30 shadow-2xl flex-shrink-0">
              <mat-icon class="text-white !w-12 !h-12 !text-5xl">{{ getTypeIcon(assessmentType) }}</mat-icon>
            </div>

            <!-- Info -->
            <div class="flex-1 text-center md:text-left">
              <h1 class="mb-2 text-2xl sm:text-3xl font-bold text-white truncate max-w-xl">
                {{ assessment.title }}
              </h1>
              <div class="mb-4 flex flex-wrap items-center justify-center gap-3 md:justify-start">
                <span class="inline-flex items-center gap-1 rounded-lg bg-white/20 px-3 py-1
                             text-sm font-bold text-white backdrop-blur-sm">
                  <mat-icon class="icon-size-4">{{ getTypeIcon(assessmentType) }}</mat-icon>
                  {{ getTypeName(assessmentType) }}
                </span>
                <span class="inline-flex items-center gap-1 rounded-lg bg-white/20 px-3 py-1
                             text-sm font-medium text-white backdrop-blur-sm">
                  <mat-icon class="icon-size-4">menu_book</mat-icon>
                  {{ assessment.subjectName }}
                </span>
                <span class="inline-flex items-center gap-1 rounded-lg bg-white/20 px-3 py-1
                             text-sm font-medium text-white backdrop-blur-sm">
                  <mat-icon class="icon-size-4">class</mat-icon>
                  {{ assessment.className }} · {{ assessment.termName }}
                </span>
              </div>
              <p *ngIf="assessment.description" class="text-sm text-white/80 max-w-xl">
                {{ assessment.description }}
              </p>
            </div>

            <!-- Status badges -->
            <div class="flex flex-col items-center gap-2">
              <span class="flex items-center gap-1 rounded-full px-4 py-2 text-sm font-bold shadow-lg"
                [ngClass]="{
                  'bg-green-500 text-white': assessment.isPublished,
                  'bg-amber-400 text-white': !assessment.isPublished
                }">
                <mat-icon class="icon-size-4">{{ assessment.isPublished ? 'public' : 'edit' }}</mat-icon>
                {{ assessment.isPublished ? 'Published' : 'Draft' }}
              </span>
              <span class="flex items-center gap-1 rounded-full bg-white/20 text-white px-4 py-2
                           text-sm font-bold shadow-lg backdrop-blur-sm">
                <mat-icon class="icon-size-4">grade</mat-icon>
                {{ assessment.maximumScore }} pts
              </span>
            </div>

          </div>
        </div>
      </div>

      <!-- ── Quick Stats ─────────────────────────────────────────────────── -->
      <div class="mb-8 grid gap-4 sm:grid-cols-2 lg:grid-cols-4">

        <div class="rounded-xl border p-4 bg-gradient-to-br"
             [ngClass]="{
               'border-indigo-200 from-indigo-50 to-white dark:border-indigo-800 dark:from-indigo-900/20 dark:to-gray-800': getTypeColor(assessmentType) === 'indigo',
               'border-violet-200 from-violet-50 to-white dark:border-violet-800 dark:from-violet-900/20 dark:to-gray-800': getTypeColor(assessmentType) === 'violet',
               'border-teal-200   from-teal-50   to-white dark:border-teal-800   dark:from-teal-900/20   dark:to-gray-800': getTypeColor(assessmentType) === 'teal'
             }">
          <div class="flex items-center gap-3">
            <div class="rounded-lg p-3"
                 [ngClass]="{
                   'bg-indigo-100 dark:bg-indigo-900/40': getTypeColor(assessmentType) === 'indigo',
                   'bg-violet-100 dark:bg-violet-900/40': getTypeColor(assessmentType) === 'violet',
                   'bg-teal-100   dark:bg-teal-900/40':   getTypeColor(assessmentType) === 'teal'
                 }">
              <mat-icon class="icon-size-6"
                [ngClass]="{
                  'text-indigo-600 dark:text-indigo-400': getTypeColor(assessmentType) === 'indigo',
                  'text-violet-600 dark:text-violet-400': getTypeColor(assessmentType) === 'violet',
                  'text-teal-600   dark:text-teal-400':   getTypeColor(assessmentType) === 'teal'
                }">{{ getTypeIcon(assessmentType) }}</mat-icon>
            </div>
            <div>
              <p class="text-xs text-gray-600 dark:text-gray-400">Type</p>
              <p class="text-sm font-bold text-gray-900 dark:text-white">{{ getTypeName(assessmentType) }}</p>
            </div>
          </div>
        </div>

        <div class="rounded-xl border border-green-200 bg-gradient-to-br from-green-50 to-white p-4
                    dark:border-green-800 dark:from-green-900/20 dark:to-gray-800">
          <div class="flex items-center gap-3">
            <div class="rounded-lg bg-green-100 p-3 dark:bg-green-900/40">
              <mat-icon class="text-green-600 dark:text-green-400 icon-size-6">grade</mat-icon>
            </div>
            <div>
              <p class="text-xs text-gray-600 dark:text-gray-400">Max Score</p>
              <p class="text-sm font-bold text-gray-900 dark:text-white">{{ assessment.maximumScore }} points</p>
            </div>
          </div>
        </div>

        <div class="rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50 to-white p-4
                    dark:border-blue-800 dark:from-blue-900/20 dark:to-gray-800">
          <div class="flex items-center gap-3">
            <div class="rounded-lg bg-blue-100 p-3 dark:bg-blue-900/40">
              <mat-icon class="text-blue-600 dark:text-blue-400 icon-size-6">assignment_turned_in</mat-icon>
            </div>
            <div>
              <p class="text-xs text-gray-600 dark:text-gray-400">Scores Entered</p>
              <p class="text-sm font-bold text-gray-900 dark:text-white">{{ assessment.scoreCount }} students</p>
            </div>
          </div>
        </div>

        <div class="rounded-xl border border-amber-200 bg-gradient-to-br from-amber-50 to-white p-4
                    dark:border-amber-800 dark:from-amber-900/20 dark:to-gray-800">
          <div class="flex items-center gap-3">
            <div class="rounded-lg bg-amber-100 p-3 dark:bg-amber-900/40">
              <mat-icon class="text-amber-600 dark:text-amber-400 icon-size-6">event</mat-icon>
            </div>
            <div>
              <p class="text-xs text-gray-600 dark:text-gray-400">Assessment Date</p>
              <p class="text-sm font-bold text-gray-900 dark:text-white">
                {{ formatDate(assessment.assessmentDate) }}
              </p>
            </div>
          </div>
        </div>

      </div>

      <!-- ── Core Details Grid ──────────────────────────────────────────── -->
      <div class="rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden mb-6">
        <div class="bg-gray-50 dark:bg-gray-800/50 px-6 py-4 border-b border-gray-200 dark:border-gray-700">
          <h3 class="text-base font-semibold text-gray-900 dark:text-white flex items-center gap-2">
            <mat-icon class="text-indigo-600 icon-size-5">info</mat-icon>
            Core Details
          </h3>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-px bg-gray-200 dark:bg-gray-700">
          <div *ngFor="let item of coreDetailItems; trackBy: trackByLabel"
               class="group bg-white dark:bg-gray-800 p-5 transition-all hover:bg-indigo-50 dark:hover:bg-indigo-900/10">
            <div class="flex items-start justify-between">
              <div class="flex-1 min-w-0">
                <div class="mb-1 flex items-center gap-2">
                  <mat-icon *ngIf="item.icon" class="text-gray-400 icon-size-4">{{ item.icon }}</mat-icon>
                  <p class="text-xs font-medium uppercase tracking-wide text-gray-500 dark:text-gray-400">
                    {{ item.label }}
                  </p>
                </div>

                <!-- Badge -->
                <span *ngIf="item.type === 'badge'"
                  class="inline-flex items-center rounded-lg px-3 py-1 text-sm font-bold"
                  [ngClass]="{
                    'bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300': getTypeColor(assessmentType) === 'indigo',
                    'bg-violet-100 dark:bg-violet-900/30 text-violet-700 dark:text-violet-300': getTypeColor(assessmentType) === 'violet',
                    'bg-teal-100   dark:bg-teal-900/30   text-teal-700   dark:text-teal-300':   getTypeColor(assessmentType) === 'teal'
                  }">
                  {{ item.value || '—' }}
                </span>

                <!-- Status -->
                <span *ngIf="item.type === 'status'"
                  class="inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold"
                  [ngClass]="{
                    'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300': item.value === 'Published',
                    'bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300': item.value === 'Draft'
                  }">
                  {{ item.value }}
                </span>

                <!-- Score -->
                <div *ngIf="item.type === 'score'" class="flex items-center gap-2">
                  <span class="text-2xl font-bold text-gray-900 dark:text-white">{{ item.value }}</span>
                  <span class="text-sm text-gray-500">points</span>
                </div>

                <!-- Boolean -->
                <span *ngIf="item.type === 'boolean'"
                  class="inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold"
                  [ngClass]="{
                    'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300': item.value === 'Yes',
                    'bg-gray-100  dark:bg-gray-700      text-gray-600  dark:text-gray-400': item.value === 'No'
                  }">
                  {{ item.value }}
                </span>

                <!-- Text / Date -->
                <p *ngIf="!item.type || item.type === 'text' || item.type === 'date'"
                  class="text-sm font-semibold text-gray-900 dark:text-white break-words">
                  {{ item.value || '—' }}
                </p>
              </div>

              <button *ngIf="item.copyable && item.value"
                mat-icon-button class="opacity-0 group-hover:opacity-100 transition-opacity shrink-0"
                (click)="copyToClipboard(item.value)"
                matTooltip="Copy">
                <mat-icon class="text-gray-400 hover:text-indigo-600 icon-size-4">content_copy</mat-icon>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- ── Type-specific Details ─────────────────────────────────────── -->
      <div *ngIf="typeSpecificItems.length > 0"
           class="rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden">
        <div
          class="px-6 py-4 border-b border-gray-200 dark:border-gray-700"
          [ngClass]="{
            'bg-indigo-50 dark:bg-indigo-900/10': getTypeColor(assessmentType) === 'indigo',
            'bg-violet-50 dark:bg-violet-900/10': getTypeColor(assessmentType) === 'violet',
            'bg-teal-50   dark:bg-teal-900/10':   getTypeColor(assessmentType) === 'teal'
          }">
          <h3 class="text-base font-semibold text-gray-900 dark:text-white flex items-center gap-2">
            <mat-icon class="icon-size-5"
              [ngClass]="{
                'text-indigo-600': getTypeColor(assessmentType) === 'indigo',
                'text-violet-600': getTypeColor(assessmentType) === 'violet',
                'text-teal-600':   getTypeColor(assessmentType) === 'teal'
              }">tune</mat-icon>
            {{ getTypeName(assessmentType) }} Settings
          </h3>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-px bg-gray-200 dark:bg-gray-700">
          <div *ngFor="let item of typeSpecificItems; trackBy: trackByLabel"
               class="group bg-white dark:bg-gray-800 p-5 transition-all"
               [ngClass]="{
                 'hover:bg-indigo-50 dark:hover:bg-indigo-900/10': getTypeColor(assessmentType) === 'indigo',
                 'hover:bg-violet-50 dark:hover:bg-violet-900/10': getTypeColor(assessmentType) === 'violet',
                 'hover:bg-teal-50   dark:hover:bg-teal-900/10':   getTypeColor(assessmentType) === 'teal'
               }">
            <div class="flex-1 min-w-0">
              <div class="mb-1 flex items-center gap-2">
                <mat-icon *ngIf="item.icon" class="text-gray-400 icon-size-4">{{ item.icon }}</mat-icon>
                <p class="text-xs font-medium uppercase tracking-wide text-gray-500 dark:text-gray-400">
                  {{ item.label }}
                </p>
              </div>
              <span *ngIf="item.type === 'badge'"
                class="inline-flex items-center rounded-lg px-3 py-1 text-sm font-bold"
                [ngClass]="{
                  'bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300': getTypeColor(assessmentType) === 'indigo',
                  'bg-violet-100 dark:bg-violet-900/30 text-violet-700 dark:text-violet-300': getTypeColor(assessmentType) === 'violet',
                  'bg-teal-100   dark:bg-teal-900/30   text-teal-700   dark:text-teal-300':   getTypeColor(assessmentType) === 'teal'
                }">{{ item.value }}</span>
              <span *ngIf="item.type === 'boolean'"
                class="inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold"
                [ngClass]="{
                  'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300': item.value === 'Yes',
                  'bg-gray-100  dark:bg-gray-700      text-gray-600  dark:text-gray-400': item.value === 'No'
                }">{{ item.value }}</span>
              <p *ngIf="!item.type || item.type === 'text'"
                class="text-sm font-semibold text-gray-900 dark:text-white break-words">
                {{ item.value || '—' }}
              </p>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>