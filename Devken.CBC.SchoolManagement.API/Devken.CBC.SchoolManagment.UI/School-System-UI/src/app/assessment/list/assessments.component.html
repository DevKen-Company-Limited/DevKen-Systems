<!-- list/assessments.component.html -->
<div class="absolute inset-0 flex min-w-0 flex-col overflow-y-auto" cdkScrollable>

  <!-- Page Header -->
  <app-page-header
    title="Assessments"
    description="Manage formative, summative and competency assessments across all classes"
    icon="assignment"
    [breadcrumbs]="breadcrumbs"
    [actionTemplate]="headerActions">
  </app-page-header>

  <ng-template #headerActions>
    <button mat-flat-button
      class="bg-white text-indigo-700 hover:bg-yellow-100 font-bold shadow-lg transition-all"
      (click)="createAssessment()">
      <mat-icon class="icon-size-5">add</mat-icon>
      <span class="ml-2">New Assessment</span>
    </button>
  </ng-template>

  <!-- Main Content -->
  <div class="bg-card -mt-10 flex-auto rounded-t-2xl p-6 shadow sm:p-10">

    <!-- Stats -->
    <app-stats-cards [cards]="statsCards" [columns]="6"></app-stats-cards>

    <!-- Filters -->
    <div class="mb-6">
      <app-filter-panel
        [fields]="filterFields"
        [showPanel]="showFilterPanel"
        [columns]="4"
        (filterChange)="onFilterChange($event)"
        (clearAll)="onClearFilters()"
        (togglePanel)="toggleFilterPanel()">
      </app-filter-panel>
    </div>

    <!-- Table -->
    <app-data-table
      [columns]="tableColumns"
      [data]="paginatedData"
      [actions]="tableActions"
      [loading]="isLoading"
      [header]="tableHeader"
      [emptyState]="tableEmptyState"
      [cellTemplates]="cellTemplates">
    </app-data-table>

    <!-- Pagination -->
    <app-pagination
      *ngIf="!isLoading"
      [currentPage]="currentPage"
      [totalItems]="filteredData.length"
      [itemsPerPage]="itemsPerPage"
      [itemLabel]="'assessments'"
      [showItemsPerPageSelector]="true"
      [showPageNumbers]="true"
      (pageChange)="onPageChange($event)"
      (itemsPerPageChange)="onItemsPerPageChange($event)">
    </app-pagination>

  </div>
</div>

<!-- ══════════════════════════════════════════════════════════════════ -->
<!-- CELL TEMPLATES                                                     -->
<!-- ══════════════════════════════════════════════════════════════════ -->

<!-- Title Cell -->
<ng-template #titleCell let-row>
  <div class="flex items-center gap-3">
    <div
      class="flex items-center justify-center w-10 h-10 rounded-xl shrink-0"
      [ngClass]="{
        'bg-indigo-100 dark:bg-indigo-900/20 border border-indigo-200 dark:border-indigo-800': getTypeColor(row.assessmentType) === 'indigo',
        'bg-violet-100 dark:bg-violet-900/20 border border-violet-200 dark:border-violet-800': getTypeColor(row.assessmentType) === 'violet',
        'bg-teal-100   dark:bg-teal-900/20   border border-teal-200   dark:border-teal-800':   getTypeColor(row.assessmentType) === 'teal'
      }">
      <mat-icon
        class="icon-size-5"
        [ngClass]="{
          'text-indigo-600 dark:text-indigo-400': getTypeColor(row.assessmentType) === 'indigo',
          'text-violet-600 dark:text-violet-400': getTypeColor(row.assessmentType) === 'violet',
          'text-teal-600   dark:text-teal-400':   getTypeColor(row.assessmentType) === 'teal'
        }">
        {{ getTypeIcon(row.assessmentType) }}
      </mat-icon>
    </div>
    <div class="min-w-0">
      <p class="text-sm font-semibold text-gray-900 dark:text-white truncate max-w-48">{{ row.title }}</p>
      <p class="text-xs text-gray-500 dark:text-gray-400 mt-0.5 truncate max-w-48">
        {{ row.subjectName }} · {{ row.className }} · {{ row.termName }}
      </p>
    </div>
  </div>
</ng-template>

<!-- Type Cell -->
<ng-template #typeCell let-row>
  <span
    class="inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-semibold"
    [ngClass]="{
      'bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300': getTypeColor(row.assessmentType) === 'indigo',
      'bg-violet-100 dark:bg-violet-900/30 text-violet-700 dark:text-violet-300': getTypeColor(row.assessmentType) === 'violet',
      'bg-teal-100   dark:bg-teal-900/30   text-teal-700   dark:text-teal-300':   getTypeColor(row.assessmentType) === 'teal'
    }">
    <mat-icon class="!text-xs !w-3.5 !h-3.5">{{ getTypeIcon(row.assessmentType) }}</mat-icon>
    {{ getTypeName(row.assessmentType) }}
  </span>
</ng-template>

<!-- Score Cell -->
<ng-template #scoreCell let-row>
  <div class="flex flex-col items-center gap-0.5">
    <span class="text-sm font-bold text-gray-900 dark:text-white">{{ row.maximumScore }}</span>
    <span class="text-xs text-gray-400">pts · {{ row.scoreCount }} scored</span>
  </div>
</ng-template>

<!-- Date Cell -->
<ng-template #dateCell let-row>
  <div class="flex items-center gap-1.5 text-sm text-gray-700 dark:text-gray-300">
    <mat-icon class="icon-size-4 text-gray-400">event</mat-icon>
    {{ formatDate(row.assessmentDate) }}
  </div>
</ng-template>

<!-- Status Cell -->
<ng-template #statusCell let-row>
  <span
    class="px-3 py-1 rounded-full text-xs font-semibold"
    [ngClass]="{
      'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400':  row.isPublished,
      'bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400': !row.isPublished
    }">
    {{ row.isPublished ? 'Published' : 'Draft' }}
  </span>
</ng-template>