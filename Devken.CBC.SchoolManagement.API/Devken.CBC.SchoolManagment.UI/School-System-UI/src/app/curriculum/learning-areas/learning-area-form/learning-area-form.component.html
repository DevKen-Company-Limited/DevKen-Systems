<!-- Learning Area Create / Edit Form -->
<div class="absolute inset-0 flex min-w-0 flex-col overflow-y-auto" cdkScrollable>

  <app-page-header
    [title]="title"
    [description]="isEditMode ? 'Update the learning area details below' : 'Fill in the details to create a new CBC learning area'"
    icon="menu_book"
    [breadcrumbs]="breadcrumbs">
  </app-page-header>

  <div class="bg-card -mt-10 flex-auto rounded-t-2xl p-6 shadow sm:p-10">

    <!-- Loading -->
    <div *ngIf="isLoading" class="flex items-center justify-center py-32">
      <mat-spinner diameter="48"></mat-spinner>
    </div>

    <div *ngIf="!isLoading" class="max-w-3xl">

      <!-- Info alert for new -->
      <fuse-alert *ngIf="!isEditMode" type="info" appearance="soft" [showIcon]="true" class="mb-6">
        Learning areas are the top-level curriculum groupings (e.g. Mathematics, English, Science). Each area belongs to a CBC level and can contain multiple strands.
      </fuse-alert>

      <form [formGroup]="form" novalidate class="space-y-6" (ngSubmit)="save()">

        <!-- School (SuperAdmin only) -->
        <mat-card *ngIf="isSuperAdmin" class="shadow-md">
          <mat-card-header class="!pb-2">
            <mat-card-title class="!text-base !font-semibold flex items-center gap-2">
              <mat-icon svgIcon="heroicons_outline:building-office-2" class="text-indigo-600"></mat-icon>
              School Assignment
              <span class="ml-auto text-xs font-medium px-2 py-1 bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300 rounded">Required</span>
            </mat-card-title>
          </mat-card-header>
          <mat-card-content class="!pt-4">
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>School *</mat-label>
              <mat-select formControlName="tenantId">
                <mat-option value="">Select school</mat-option>
                <mat-option *ngFor="let s of schools" [value]="s.id">{{ s.name }}</mat-option>
              </mat-select>
              <mat-icon matPrefix svgIcon="heroicons_outline:building-library" class="text-gray-400"></mat-icon>
              <mat-error>{{ getError('tenantId') }}</mat-error>
            </mat-form-field>
          </mat-card-content>
        </mat-card>

        <!-- Core Details -->
        <mat-card class="shadow-md">
          <mat-card-header class="!pb-2">
            <mat-card-title class="!text-base !font-semibold flex items-center gap-2">
              <mat-icon svgIcon="heroicons_outline:information-circle" class="text-indigo-600"></mat-icon>
              Learning Area Details
              <span class="ml-auto text-xs font-medium px-2 py-1 bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300 rounded">Required</span>
            </mat-card-title>
          </mat-card-header>
          <mat-card-content class="!pt-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

              <mat-form-field appearance="outline" class="w-full md:col-span-2">
                <mat-label>Name *</mat-label>
                <input matInput formControlName="name" placeholder="e.g. Mathematics, English Language, Science">
                <mat-icon matPrefix svgIcon="heroicons_outline:book-open" class="text-gray-400"></mat-icon>
                <mat-hint>The full name of the learning area</mat-hint>
                <mat-error>{{ getError('name') }}</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="w-full">
                <mat-label>Code</mat-label>
                <input matInput formControlName="code" placeholder="e.g. MATH, ENG, SCI">
                <mat-icon matPrefix svgIcon="heroicons_outline:hashtag" class="text-gray-400"></mat-icon>
                <mat-hint>Short unique code (optional, max 20 chars)</mat-hint>
                <mat-error>{{ getError('code') }}</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="w-full">
                <mat-label>CBC Level *</mat-label>
                <mat-select formControlName="level">
                  <mat-option value="">Select level</mat-option>
                  <mat-option *ngFor="let l of cbcLevels" [value]="l.value">
                    {{ l.label }}
                  </mat-option>
                </mat-select>
                <mat-icon matPrefix svgIcon="heroicons_outline:chart-bar" class="text-gray-400"></mat-icon>
                <mat-hint>The CBC level this area belongs to</mat-hint>
                <mat-error>{{ getError('level') }}</mat-error>
              </mat-form-field>

            </div>
          </mat-card-content>
        </mat-card>

        <!-- Actions -->
        <div class="flex items-center justify-end gap-4 pt-2">
          <button type="button" mat-stroked-button (click)="cancel()" [disabled]="isSaving">
            Cancel
          </button>
          <button type="submit" mat-flat-button color="primary" [disabled]="isSaving">
            <mat-spinner *ngIf="isSaving" diameter="18" class="inline-block mr-2"></mat-spinner>
            <mat-icon *ngIf="!isSaving" svgIcon="heroicons_outline:check"></mat-icon>
            <span class="ml-2">{{ isSaving ? 'Savingâ€¦' : (isEditMode ? 'Update' : 'Create') }}</span>
          </button>
        </div>

      </form>
    </div>
  </div>
</div>