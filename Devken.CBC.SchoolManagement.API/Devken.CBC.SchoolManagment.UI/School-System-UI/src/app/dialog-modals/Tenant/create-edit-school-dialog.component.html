<div class="flex flex-col max-h-[90vh]">
  <!-- Header -->
  <div class="flex items-center gap-3 p-6 border-b bg-card dark:bg-gray-900">
    <div 
      class="w-12 h-12 rounded-lg flex items-center justify-center shadow-sm"
      [class.bg-gradient-to-br]="true"
      [class.from-primary-400]="true"
      [class.to-primary-600]="true">
      <mat-icon 
        class="text-white icon-size-6" 
        [svgIcon]="data.mode === 'create' ? 'heroicons_outline:plus-circle' : 'heroicons_outline:pencil'">
      </mat-icon>
    </div>
    <div class="flex-1">
      <h2 mat-dialog-title class="text-2xl font-bold text-gray-900 dark:text-white mb-1">
        {{ data.mode === 'create' ? 'Create New School' : 'Edit School' }}
      </h2>
      <p class="text-sm text-gray-600 dark:text-gray-400">
        {{ data.mode === 'create' ? 'Add a new school to the system' : 'Update school information' }}
      </p>
    </div>
    <button 
      mat-icon-button 
      [mat-dialog-close]="null"
      matTooltip="Close">
      <mat-icon [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
    </button>
  </div>

  <!-- Form Content -->
  <form [formGroup]="form" (ngSubmit)="submit()" mat-dialog-content class="flex-1 overflow-y-auto p-6">
    <!-- Validation Errors -->
    <div 
      *ngIf="form.invalid && (form.touched || form.dirty)" 
      class="mb-4 p-3 bg-red-50 dark:bg-red-900 border border-red-200 dark:border-red-700 rounded-lg">
      <div class="flex items-center gap-2 text-red-800 dark:text-red-200">
        <mat-icon class="icon-size-5">error_outline</mat-icon>
        <span class="font-medium">Please fix the following errors:</span>
      </div>
      <ul class="mt-1 ml-6 text-sm text-red-700 dark:text-red-300 list-disc">
        <li *ngIf="form.get('name')?.hasError('required')">School name is required</li>
        <li *ngIf="form.get('name')?.hasError('minlength')">School name must be at least 3 characters</li>
        <li *ngIf="form.get('slugName')?.hasError('required')">Slug is required</li>
        <li *ngIf="form.get('slugName')?.hasError('pattern')">Slug can only contain lowercase letters, numbers, and hyphens</li>
        <li *ngIf="form.get('email')?.hasError('email')">Please enter a valid email address</li>
        <li *ngIf="form.get('website')?.hasError('pattern')">Please enter a valid website URL</li>
      </ul>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- Left Column -->
      <div class="space-y-4">
        <!-- School Name -->
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>School Name *</mat-label>
          <input 
            matInput 
            formControlName="name" 
            placeholder="Enter school name"
            autocomplete="off">
          <mat-icon matPrefix [svgIcon]="'heroicons_outline:academic-cap'"></mat-icon>
          <mat-hint>Full name of the school (3-100 characters)</mat-hint>
          <mat-error *ngIf="form.get('name')?.hasError('required')">
            School name is required
          </mat-error>
          <mat-error *ngIf="form.get('name')?.hasError('minlength')">
            School name must be at least 3 characters
          </mat-error>
          <mat-error *ngIf="form.get('name')?.hasError('maxlength')">
            School name cannot exceed 100 characters
          </mat-error>
        </mat-form-field>

        <!-- Slug -->
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Slug *</mat-label>
          <input 
            matInput 
            formControlName="slugName" 
            placeholder="school-slug-name"
            autocomplete="off">
          <mat-icon matPrefix [svgIcon]="'heroicons_outline:link'"></mat-icon>
          <mat-hint>URL-friendly identifier (lowercase, numbers, hyphens)</mat-hint>
          <button 
            mat-icon-button 
            matSuffix 
            (click)="generateSlug()"
            type="button"
            matTooltip="Generate slug from name">
            <mat-icon [svgIcon]="'heroicons_outline:sparkles'"></mat-icon>
          </button>
          <mat-error *ngIf="form.get('slugName')?.hasError('required')">
            Slug is required
          </mat-error>
          <mat-error *ngIf="form.get('slugName')?.hasError('pattern')">
            Only lowercase letters, numbers, and hyphens allowed
          </mat-error>
          <mat-error *ngIf="form.get('slugName')?.hasError('minlength')">
            Slug must be at least 3 characters
          </mat-error>
        </mat-form-field>

        <!-- Email -->
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Email</mat-label>
          <input 
            matInput 
            type="email" 
            formControlName="email" 
            placeholder="school@example.com"
            autocomplete="off">
          <mat-icon matPrefix [svgIcon]="'heroicons_outline:envelope'"></mat-icon>
          <mat-error *ngIf="form.get('email')?.hasError('email')">
            Please enter a valid email address
          </mat-error>
        </mat-form-field>

        <!-- Phone -->
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Phone Number</mat-label>
          <input 
            matInput 
            formControlName="phoneNumber" 
            placeholder="+1 (555) 123-4567"
            autocomplete="off">
          <mat-icon matPrefix [svgIcon]="'heroicons_outline:phone'"></mat-icon>
          <mat-error *ngIf="form.get('phoneNumber')?.hasError('pattern')">
            Please enter a valid phone number
          </mat-error>
        </mat-form-field>

        <!-- Website -->
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Website</mat-label>
          <input 
            matInput 
            formControlName="website" 
            placeholder="https://school.example.com"
            autocomplete="off">
          <mat-icon matPrefix [svgIcon]="'heroicons_outline:globe-alt'"></mat-icon>
          <mat-error *ngIf="form.get('website')?.hasError('pattern')">
            Please enter a valid website URL
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Right Column -->
      <div class="space-y-4">
        <!-- Logo URL -->
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Logo URL</mat-label>
          <input 
            matInput 
            formControlName="logoUrl" 
            placeholder="https://example.com/logo.png"
            autocomplete="off">
          <mat-icon matPrefix [svgIcon]="'heroicons_outline:photo'"></mat-icon>
          <mat-hint>URL to school logo image (PNG, JPG, SVG)</mat-hint>
          <mat-error *ngIf="form.get('logoUrl')?.hasError('pattern')">
            Please enter a valid image URL
          </mat-error>
        </mat-form-field>

        <!-- Address -->
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Address</mat-label>
          <textarea 
            matInput 
            formControlName="address" 
            placeholder="123 Main St, City, State, ZIP"
            rows="3"></textarea>
          <mat-icon matPrefix [svgIcon]="'heroicons_outline:map-pin'"></mat-icon>
          <mat-hint>Physical address of the school</mat-hint>
        </mat-form-field>

        <!-- Description -->
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Description</mat-label>
          <textarea 
            matInput 
            formControlName="description" 
            placeholder="Brief description of the school..."
            rows="3"></textarea>
          <mat-icon matPrefix [svgIcon]="'heroicons_outline:document-text'"></mat-icon>
          <mat-hint>Optional description (max 500 characters)</mat-hint>
          <mat-error *ngIf="form.get('description')?.hasError('maxlength')">
            Description cannot exceed 500 characters
          </mat-error>
        </mat-form-field>

        <!-- Configuration Section -->
        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 space-y-3">
          <div class="flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            <mat-icon class="icon-size-4" [svgIcon]="'heroicons_outline:cog-6-tooth'"></mat-icon>
            <span>Configuration</span>
          </div>

          <!-- Max Users -->
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Maximum Users</mat-label>
            <input 
              matInput 
              type="number" 
              formControlName="maxUsers" 
              min="1" 
              max="10000"
              autocomplete="off">
            <mat-icon matPrefix [svgIcon]="'heroicons_outline:users'"></mat-icon>
            <mat-hint>Maximum number of users allowed</mat-hint>
            <mat-error *ngIf="form.get('maxUsers')?.hasError('min')">
              Must be at least 1 user
            </mat-error>
            <mat-error *ngIf="form.get('maxUsers')?.hasError('max')">
              Cannot exceed 10,000 users
            </mat-error>
          </mat-form-field>

          <!-- Status -->
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-2">
              <mat-icon class="text-green-600 icon-size-5" [svgIcon]="'heroicons_outline:check-circle'"></mat-icon>
              <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Active Status</span>
            </div>
            <mat-slide-toggle 
              formControlName="isActive"
              color="primary">
              {{ form.get('isActive')?.value ? 'Active' : 'Inactive' }}
            </mat-slide-toggle>
          </div>
        </div>
      </div>
    </div>
  </form>

  <!-- Footer -->
  <div mat-dialog-actions class="flex justify-between items-center gap-2 p-4 border-t bg-gray-50 dark:bg-gray-900">
    <div class="text-sm text-gray-500 dark:text-gray-400">
      <span class="font-medium">*</span> Required fields
    </div>
    <div class="flex items-center gap-2">
      <button 
        mat-stroked-button 
        type="button" 
        (click)="cancel()"
        [disabled]="isSaving">
        Cancel
      </button>
      <button 
        mat-flat-button 
        color="primary" 
        type="submit"
        (click)="submit()"
        [disabled]="form.invalid || isSaving"
        class="flex items-center gap-2">
        <mat-icon *ngIf="isSaving" class="animate-spin" [svgIcon]="'heroicons_outline:arrow-path'"></mat-icon>
        <mat-icon *ngIf="!isSaving" [svgIcon]="data.mode === 'create' ? 'heroicons_outline:plus' : 'heroicons_outline:check'"></mat-icon>
        {{ isSaving ? 'Saving...' : (data.mode === 'create' ? 'Create School' : 'Save Changes') }}
      </button>
    </div>
  </div>
</div>