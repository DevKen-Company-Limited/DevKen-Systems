<!-- Dialog Header -->
<div class="flex items-center justify-between px-6 py-4 bg-gradient-to-r from-teal-600 via-cyan-600 to-blue-600 shrink-0">
  <div class="flex items-center gap-3">
    <div class="w-9 h-9 bg-white/20 rounded-xl flex items-center justify-center">
      <mat-icon class="text-white">format_list_bulleted</mat-icon>
    </div>
    <div>
      <h2 class="text-base font-bold text-white leading-tight">
        {{ isEditMode ? 'Edit Sub-Strand' : 'Create Sub-Strand' }}
      </h2>
      <p class="text-xs text-white/70">
        {{ isEditMode ? 'Update the sub-strand details' : 'Create a new sub-strand within a strand' }}
      </p>
    </div>
  </div>
  <button mat-icon-button (click)="cancel()" class="text-white/80 hover:text-white hover:bg-white/10 rounded-xl">
    <mat-icon>close</mat-icon>
  </button>
</div>

<!-- Loading -->
<div *ngIf="isLoading" class="flex items-center justify-center py-16 bg-gray-50 dark:bg-gray-900">
  <mat-spinner diameter="40"></mat-spinner>
</div>

<!-- Form Body -->
<form *ngIf="!isLoading" [formGroup]="form" novalidate (ngSubmit)="save()" class="flex flex-col bg-gray-50 dark:bg-gray-900">

  <div class="p-6 space-y-5 overflow-y-auto max-h-[60vh]">

    <fuse-alert *ngIf="!isEditMode" type="info" appearance="soft" [showIcon]="true">
      Sub-strands are specific topics within a strand (e.g. under Numbers: Whole Numbers, Fractions, Decimals).
    </fuse-alert>

    <!-- School (SuperAdmin only) -->
    <div *ngIf="isSuperAdmin">
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>School <span class="text-red-500">*</span></mat-label>
        <mat-select formControlName="tenantId" placeholder="Select school">
          <mat-option value="">Select school</mat-option>
          <mat-option *ngFor="let s of schools" [value]="s.id">{{ s.name }}</mat-option>
        </mat-select>
        <mat-error>{{ getError('tenantId') }}</mat-error>
      </mat-form-field>
    </div>

    <!-- Sub-Strand Name -->
    <mat-form-field appearance="outline" class="w-full">
      <mat-label>Sub-Strand Name <span class="text-red-500">*</span></mat-label>
      <input matInput formControlName="name" placeholder="e.g. Whole Numbers, Fractions, Living Things">
      <mat-icon matPrefix class="text-gray-400">label</mat-icon>
      <mat-hint>The name of the sub-strand within the strand</mat-hint>
      <mat-error>{{ getError('name') }}</mat-error>
    </mat-form-field>

    <!-- Learning Area -->
    <mat-form-field appearance="outline" class="w-full">
      <mat-label>Learning Area</mat-label>
      <mat-select formControlName="learningAreaId" placeholder="Select learning area"
        (selectionChange)="onLearningAreaChange($event.value)">
        <mat-option value="">Select learning area</mat-option>
        <mat-option *ngFor="let la of learningAreas" [value]="la.id">
          {{ la.name }}{{ la.code ? ' (' + la.code + ')' : '' }}
        </mat-option>
      </mat-select>
      <mat-icon matPrefix class="text-gray-400">menu_book</mat-icon>
      <mat-hint>Filter strands by learning area</mat-hint>
    </mat-form-field>

    <!-- Strand -->
    <mat-form-field appearance="outline" class="w-full">
      <mat-label>Strand <span class="text-red-500">*</span></mat-label>
      <mat-select formControlName="strandId" placeholder="Select strand">
        <mat-option value="">Select strand</mat-option>
        <mat-option *ngFor="let s of filteredStrands" [value]="s.id">
          {{ s.name }}
        </mat-option>
      </mat-select>
      <mat-icon matPrefix class="text-gray-400">account_tree</mat-icon>
      <mat-hint>The strand this sub-strand belongs to</mat-hint>
      <mat-error>{{ getError('strandId') }}</mat-error>
    </mat-form-field>

  </div>

  <!-- Footer -->
  <div class="flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 shrink-0">
    <button type="button" mat-stroked-button (click)="cancel()" [disabled]="isSaving">Cancel</button>
    <button type="submit" mat-flat-button color="primary" [disabled]="isSaving"
      class="bg-gradient-to-r from-teal-600 to-blue-600 text-white min-w-28">
      <mat-spinner *ngIf="isSaving" diameter="18" class="mr-2 inline-block"></mat-spinner>
      <mat-icon *ngIf="!isSaving" class="mr-1">{{ isEditMode ? 'save' : 'add' }}</mat-icon>
      {{ isSaving ? 'Savingâ€¦' : (isEditMode ? 'Update' : 'Create') }}
    </button>
  </div>

</form>